

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Session 2 &mdash; ROS2 Basics  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=7ab3649f" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="_static/code-tabs.css?v=1bc26e2f" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=51e3bf41" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="_static/togglebutton.js?v=4a39c7ea"></script>
      <script src="_static/code-tabs.js?v=c983d12e"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="_static/custom.js?v=6fd1e3d1"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Preparatory Work 3" href="prep_work_3.html" />
    <link rel="prev" title="Preparatory Work 2" href="prep_work_2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            ROS2 Basics
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="prep_work_1.html">Preparatory Work 1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#why-ros2">Why ROS2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#selecting-a-ros2-distribution">Selecting a ROS2 Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#why-docker">Why Docker?</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#installing-docker-desktop">Installing Docker Desktop</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#exploring-tools">Exploring Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#learning-basic-linux-commands">Learning Basic Linux Commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="session_1.html">Session 1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#feedback-form">Feedback Form</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#ros2-installation">ROS2 Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#ros2-project-build">ROS2 Project Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#first-node">First Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#communication-overview">Communication Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#topics-overview">Topics Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#exercise-1">Exercise 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#parameters-overview-optional">Parameters Overview - Optional</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#services-overview">Services Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#custom-interfaces">Custom Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prep_work_2.html">Preparatory Work 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prep_work_2.html#thymio-example">Thymio Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_2.html#exercise-2">Exercise 2</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Session 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#urdf-tutorial-example">URDF Tutorial Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#launch-files-overview">Launch Files Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#urdf-overview">URDF Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#minimal-urdf-visual">Minimal URDF - Visual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#first-link">First Link</a></li>
<li class="toctree-l3"><a class="reference internal" href="#first-joint">First Joint</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thymio-step-1">Thymio - Step 1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#improved-urdf-xacro">Improved URDF - Xacro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#thymio-step-2">Thymio - Step 2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gazebo-overview">Gazebo Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#complete-urdf-collision-inertial">Complete URDF - Collision &amp; Inertial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#collision-tags">Collision Tags</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inertial-tags">Inertial Tags</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thymio-step-3">Thymio - Step 3</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#spawn-robot-in-gazebo">Spawn Robot in Gazebo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#thymio-step-4">Thymio - Step 4</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gazebo-plugins">Gazebo Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#thymio-step-5">Thymio - Step 5</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thymio-step-6">Thymio - Step 6</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#feedback-form">Feedback Form</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gazebo-worlds-optional">Gazebo Worlds - Optional</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prep_work_3.html">Preparatory Work 3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prep_work_3.html#turtlesim-overview">Turtlesim Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_3.html#exercise-3">Exercise 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_3.html#simulation-underlays-optional">Simulation Underlays - Optional</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="session_3.html">Session 3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="session_3.html#thymio-mini-project-overview">Thymio Mini-Project Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_3.html#thymio-mini-project">Thymio Mini-Project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-1">Step 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-2">Step 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-3">Step 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-4">Step 4</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-5">Step 5</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-6">Step 6</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#feedback-form">Feedback Form</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-7-bonus">Step 7 - Bonus</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#extra-optional">Extra - Optional</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cheat_sheet.html">Cheat Sheet</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cheat_sheet.html#ros2-commands">ROS2 Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cheat_sheet.html#workspace-package-management">Workspace &amp; Package Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="cheat_sheet.html#running-launching-nodes">Running &amp; Launching Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="cheat_sheet.html#debugging-inspection">Debugging &amp; Inspection</a></li>
<li class="toctree-l3"><a class="reference internal" href="cheat_sheet.html#tools-utilities">Tools &amp; Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cheat_sheet.html#ros2-basic-structures">ROS2 Basic Structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cheat_sheet.html#minimal-node">Minimal Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="cheat_sheet.html#minimal-publisher">Minimal Publisher</a></li>
<li class="toctree-l3"><a class="reference internal" href="cheat_sheet.html#minimal-subscriber">Minimal Subscriber</a></li>
<li class="toctree-l3"><a class="reference internal" href="cheat_sheet.html#minimal-server">Minimal Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="cheat_sheet.html#minimal-client">Minimal Client</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ROS2 Basics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Session 2</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/session_2.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="session-2">
<h1>Session 2<a class="headerlink" href="#session-2" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>Welcome to session 2 of our ROS2 Basics labs! Today, we will be exploring the visualization and simulation tools integrated with ROS2. In this session, we will dive into Rviz, Transforms (TFs), launch files, URDF, Xacro, and Gazebo, building the essential skills for designing and simulating robotic systems.</p>
<p>Our main goal for today is to create a model of the Thymio robot that is fully integrated with ROS2 and capable of smooth operation in Gazebo simulation. We will guide you step by step through the essential elements needed to achieve this. You will begin with simple examples to introduce each concept and gradually apply this knowledge to build the Thymio model. Now, let’s get to work!</p>
</section>
<section id="urdf-tutorial-example">
<h2>URDF Tutorial Example<a class="headerlink" href="#urdf-tutorial-example" title="Link to this heading"></a></h2>
<p>In this first part of the session, we will start by exploring <strong>Rviz</strong>, a 3D visualization tool, and <strong>TFs</strong> (transform frames), which are essential for managing coordinate frames in ROS2. We will use an example <strong>URDF</strong> (Unified Robot Description Format) model to learn how to visualize and interact with a robot model in Rviz. Do not worry if these concepts do not fully make sense yet, we will go through each of them step by step throughout today’s session.</p>
<p>Let’s get started by ensuring that everything we need is installed and set up. The first step is to install the <em>urdf_tutorial</em> package. This package is not part of the default ROS2 installation, so let’s install it now.</p>
<ol class="arabic simple">
<li><p>Open a terminal and run:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ros-humble-urdf-tutorial<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">source</span><span class="w"> </span>/opt/ros/humble/setup.bash
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have been paying attention to the terminal messages, you may have noticed that this package is already installed in the Docker environment. Due to time considerations, we have not covered all the steps of the installation process. However, the following outlines the general procedure you can follow to install any new package in ROS2.</p>
<div class="table-centered"><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Step</p></th>
<th class="head"><p>Task</p></th>
<th class="head"><p>Command</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p><strong>Update</strong> your package
list</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">update</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p><strong>Upgrade</strong> existing
packages</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">upgrade</span></code></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p><strong>Install</strong> the desired
package</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">ros-&lt;distro&gt;-&lt;package_name&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p><strong>Source</strong> the ROS2
setup file</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/opt/ros/&lt;distro&gt;/setup.bash</span></code></p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p><strong>Verify</strong> the package
installation</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">pkg</span> <span class="pre">list</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&lt;package_name&gt;</span></code></p></td>
</tr>
</tbody>
</table>
</div></div>
<ol class="arabic simple" start="2">
<li><p>Let’s check where this package and others are installed:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/opt/ros/humble/share<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ls
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Navigate to the URDF folder of the <em>urdf_tutorial</em> package and check its content:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/opt/ros/humble/share/urdf_tutorial/urdf<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ls
</pre></div>
</div>
<p>Among the files listed, you will see <cite>08-macroed.urdf.xacro</cite>, which is the example we will use now.</p>
<ol class="arabic simple" start="4">
<li><p>Launch the example:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>urdf_tutorial<span class="w"> </span>display.launch.py<span class="w"> </span>model:<span class="o">=</span>/opt/ros/humble/share/urdf_tutorial/urdf/08-macroed.urdf.xacro
</pre></div>
</div>
<p>Now that Rviz is running and the robot model is loaded, let’s take a moment to explore what Rviz offers and why it is such a valuable tool in the ROS2 ecosystem. Visualizing the robot in a 3D environment provides an intuitive way to understand its structure, relationships, and interactions.</p>
<p>In particular, Rviz allows you to visualize:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Robot models</strong>: These are detailed representations of the robot’s physical structure.</p></li>
<li><p><strong>Transform frames (TFs)</strong>: Coordinate frames that define the spatial relationships between different parts of the robot, essential for motion and interaction.</p></li>
<li><p><strong>Sensors data</strong>:  Information from sensors such as LiDAR, cameras, or depth sensors, displayed in real-time to help interpret the robot’s environment.</p></li>
</ul>
</div></blockquote>
<p>As you can see in the image below, Rviz offers a variety of default plugins that enable you to monitor different aspects of your system. These plugins can be accessed and added to your workspace by clicking the <code class="docutils literal notranslate"><span class="pre">Add</span></code> button in the Rviz interface.</p>
<a class="reference internal image-reference" href="_images/rviz_plugins.png"><img alt="_images/rviz_plugins.png" class="align-center" src="_images/rviz_plugins.png" style="width: 20%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<p>Rviz also allows you to interact with tools like the <em>Joint State Publisher</em> (the second pop-up window), a GUI that lets you manipulate the robot’s joints. This enables you to see how joint movements affect the robot’s structure.</p>
<p>A key question to consider here is: <strong>How does ROS2 determine the positions and movements of the different links relative to one another over time?</strong></p>
<p>The answer lies in <strong>Transform Frames (TFs)</strong>. These frames represent the spatial relationships (positions and orientations) between the robot’s parts and its environment. TFs enable ROS2 to continuously track how each part of the robot moves in relation to others. By maintaining structured relationships between frames, TFs play a crucial role in various robotic tasks.</p>
<p>Each frame has three axes: x (red), y (green), and z (blue), representing its orientation in 3D space. If you uncheck the <code class="docutils literal notranslate"><span class="pre">RobotModel</span></code> in Rviz, you can see that the TFs form a tree-like structure, showing how the robot’s rigid parts are connected.</p>
<p>To better visualize the TF hierarchy, you can use the <em>view_frames</em> tool provided by the <em>tf2_tools</em> package. Open a terminal and run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ros2_basics_ws/
ros2<span class="w"> </span>run<span class="w"> </span>tf2_tools<span class="w"> </span>view_frames
</pre></div>
</div>
<p>After about five seconds, a PDF will be generated in your workspace. This file provides a clear tree structure of the robot’s TFs. The <code class="docutils literal notranslate"><span class="pre">base_link</span></code> is the root of the TF tree, and all other frames are connected as branches. Each branch connects a <strong>parent link</strong> to a <strong>child link</strong>, meaning that if the parent link moves, the child link will move accordingly.</p>
<p>Now that you understand the purpose of TFs, you can experiment in Rviz to see how they work alongside the <code class="docutils literal notranslate"><span class="pre">RobotModel</span></code>. Start by focusing on the <code class="docutils literal notranslate"><span class="pre">RobotModel</span></code>:</p>
<ol class="arabic simple">
<li><p>Hide TFs and explore the <code class="docutils literal notranslate"><span class="pre">RobotModel</span></code> by displaying all links or only a few.</p></li>
<li><p>Adjust joints using the <em>Joint State Publisher</em> and observe changes.</p></li>
</ol>
<p>Next, enable the TFs and hide the <code class="docutils literal notranslate"><span class="pre">RobotModel</span></code> to focus on the transform frames:</p>
<ol class="arabic simple">
<li><p>Display all or specific frames to examine their relationships.</p></li>
<li><p>Observe how frames update dynamically with joint adjustments.</p></li>
</ol>
<p>By now, you should have a foundational understanding of Rviz and TFs. Here’s a quick recap:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Rviz</strong> is a visualization tool that helps display robot models, TFs, and many other essential elements .</p></li>
<li><p><strong>TFs</strong> are essential for representing spatial relationships and movement between different parts of the robot.</p></li>
</ul>
</div></blockquote>
<p>These tools are invaluable for building and visualizing robot models in ROS2.</p>
<p>Let’s keep going! In the next chapters, we will dive deeper into understanding and working with URDF files to create our own robot model.</p>
</section>
<section id="launch-files-overview">
<h2>Launch Files Overview<a class="headerlink" href="#launch-files-overview" title="Link to this heading"></a></h2>
<p>At this stage, you have already visualized a robot model in Rviz using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>urdf_tutorial<span class="w"> </span>display.launch.py<span class="w"> </span>model:<span class="o">=</span>&lt;path_to_urdf&gt;
</pre></div>
</div>
<p>You might have been wondering, what does the <em>launch</em> command do? Simply put, it runs a <strong>launch file</strong>. A launch file is a configuration file that allows you to start multiple nodes simultaneously, often with specific parameters or remapping. This is especially useful when managing complex setups, as launching multiple nodes manually from different terminals can quickly become difficult to manage.</p>
<p>Launch files provide a structured way to:</p>
<ul class="simple">
<li><p>Start multiple nodes simultaneously</p></li>
<li><p>Apply specific parameters</p></li>
<li><p>Remap topics and services</p></li>
<li><p>Load additional configurations</p></li>
</ul>
<p>Launch files can be written in <strong>Python</strong>, <strong>XML</strong>, or <strong>YAML</strong>. For simplicity and conciseness, we will use the XML format in this course.</p>
<div class="admonition-action-required admonition">
<p class="admonition-title">Action Required</p>
<p>Please <a class="reference download internal" download="" href="_downloads/3e5e38a54cb8013f178aae8de189ab5b/thymio_description.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span></code></a> the <code class="docutils literal notranslate"><span class="pre">thymio_description</span></code> package required for this session and place it in the <code class="docutils literal notranslate"><span class="pre">/src</span></code> directory of your <code class="docutils literal notranslate"><span class="pre">ros2_basics_ws</span></code> workspace.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Following a common convention, a robot’s model is typically stored in a package named <code class="docutils literal notranslate"><span class="pre">&lt;robot_name&gt;_description</span></code>, which organizes related files into structured folders. In our case, the <code class="docutils literal notranslate"><span class="pre">thymio_description</span></code> package contains several folders (<em>launch</em>, <em>rviz</em>, <em>urdf</em>, and <em>worlds</em>) that will be gradually filled with additional content as we progress.</p>
<p>Keep in mind that when new folders are added to a package, they are not automatically recognized by ROS2. To make them accessible, they must be installed in the package’s <code class="docutils literal notranslate"><span class="pre">/share</span></code> directory. If you check the <em>setup.py</em> file, you will notice that this step has already been handled for you.</p>
</div>
<p>Let’s revisit an example from Session 1, illustrated in the image below, to better understand launch files. This time, instead of manually starting each node, we will use a launch file to simultaneously launch four nodes with their appropriate configurations.</p>
<a class="reference internal image-reference" href="_images/task2.png"><img alt="_images/task2.png" class="align-center" src="_images/task2.png" style="width: 60%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<ol class="arabic">
<li><p>Open the file <em>example.launch.xml</em></p>
<p>Navigate to the <em>/thymio_description/launch</em> folder and open the <em>example.launch.xml</em> file.</p>
</li>
<li><p>Add the following code to the file</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>
<span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;demo_nodes_py&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;talker&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;stress&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;remap</span><span class="w"> </span><span class="na">from=</span><span class="s">&quot;chatter&quot;</span><span class="w"> </span><span class="na">to=</span><span class="s">&quot;exams&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/node&gt;</span>

<span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;demo_nodes_py&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;talker&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BA1_students&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;remap</span><span class="w"> </span><span class="na">from=</span><span class="s">&quot;chatter&quot;</span><span class="w"> </span><span class="na">to=</span><span class="s">&quot;exams&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/node&gt;</span>

<span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;demo_nodes_py&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;listener&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BA2&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;remap</span><span class="w"> </span><span class="na">from=</span><span class="s">&quot;chatter&quot;</span><span class="w"> </span><span class="na">to=</span><span class="s">&quot;exams&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/node&gt;</span>

<span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;demo_nodes_py&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;listener&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MAN&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;remap</span><span class="w"> </span><span class="na">from=</span><span class="s">&quot;chatter&quot;</span><span class="w"> </span><span class="na">to=</span><span class="s">&quot;exams&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p>What are the essential elements of a launch file?</p>
</div>
</div></blockquote>
<p><div style="margin-top: 5px;"></div></p>
<ol class="arabic" start="3">
<li><p>Build and source the package</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ros2_basics_ws/
colcon<span class="w"> </span>build<span class="w"> </span>--packages-select<span class="w"> </span>thymio_description
<span class="nb">source</span><span class="w"> </span>install/setup.bash
</pre></div>
</div>
</li>
<li><p>Run the launch file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>thymio_description<span class="w"> </span>example.launch.xml
</pre></div>
</div>
</li>
<li><p>Visualize the result</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rqt_graph
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using a launch file, you have successfully started multiple nodes with a single command. Additionally, remapping topics has become significantly more convenient.</p>
</div>
<p>To save time during this class, we will not go over the creation of the launch files required for this session, as they are more advanced than the basic example we have just seen. Instead, the necessary launch files are already prepared and included in the <code class="docutils literal notranslate"><span class="pre">thymio_description</span></code> package. But don’t despair! We will revisit and analyze these files in detail during Preparatory Work 3.</p>
</section>
<section id="urdf-overview">
<h2>URDF Overview<a class="headerlink" href="#urdf-overview" title="Link to this heading"></a></h2>
<p>In the introductory example, the need for TFs (Transform Frames) in robotics was highlighted. TFs play a crucial role in tracking the positions of different parts of a robot over time. They are essential for most control packages in ROS2 to function effectively.</p>
<p>For example:</p>
<ul class="simple">
<li><p><strong>Odometry</strong> in navigation requires the positions of the wheels to estimate a mobile robot’s pose.</p></li>
<li><p><strong>Robotic arms</strong> need joint positions to calculate the pose of the end-effector.</p></li>
</ul>
<p>In short, accurate TFs are vital for running a robot in ROS2. Fortunately, ROS2 handles the management of TFs. The only requirement is to provide a <strong>URDF file</strong>, which describes the robot’s elements in <strong>XML format</strong>.</p>
<p>A URDF, Unified Robot Description Format, consists of two main components:</p>
<ul class="simple">
<li><p><strong>Links</strong>: Represent the physical, rigid parts of the robot. These correspond to the <code class="docutils literal notranslate"><span class="pre">RobotModel</span></code> in Rviz.</p></li>
<li><p><strong>Joints</strong>: Define the relationships between links and are used by ROS2 to generate TFs.</p></li>
</ul>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="_images/urdf.png"><img alt="_images/urdf.png" src="_images/urdf.png" style="width: 40%;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://web.enib.fr/~buche/data/IML/class_ROS2_tools.html" rel="noopener noreferrer" target="_blank">URDF representation</a></span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Links are the rigid bodies of a robot. They can be described using one of the four types of geometry: <strong>boxes</strong>, <strong>cylinders</strong>, <strong>spheres</strong>, and <strong>meshes</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this class, only basic geometry shapes will be used. While meshes can be included in a URDF, they require a CAD-designed mesh file (e.g. an STL file). When using meshes, it is important to pay attention to scaling and orientation.</p>
</div>
<p>To fully define a link, three properties must be specified:</p>
<ul class="simple">
<li><p><strong>Visual</strong>: How the link appears in visualization tools</p></li>
<li><p><strong>Inertial</strong>: The physical properties (mass, center of gravity, etc.)</p></li>
<li><p><strong>Collision</strong>: The geometry used for collision detection</p></li>
</ul>
<p>These properties will be introduced progressively throughout the session.</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="_images/links.png"><img alt="_images/links.png" src="_images/links.png" style="width: 50%;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="http://wiki.ros.org/urdf/XML/link" rel="noopener noreferrer" target="_blank">Link representation</a></span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Joints define the connections between links. The most common types of joints in ROS2 are:</p>
<ol class="arabic simple">
<li><p><strong>Fixed</strong>: No movement between the parent and child links</p></li>
<li><p><strong>Revolute</strong>: Rotation around a single axis within a defined range</p></li>
<li><p><strong>Continuous</strong>: Rotation around a single axis without limits</p></li>
<li><p><strong>Prismatic</strong>: Linear motion along a single axis</p></li>
</ol>
<p>A joint is always defined by its <strong>parent link</strong> and <strong>child link</strong>.</p>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="_images/joints.png"><img alt="_images/joints.png" src="_images/joints.png" style="width: 50%;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="http://wiki.ros.org/urdf/XML/joint" rel="noopener noreferrer" target="_blank">Joint representation</a></span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>For more information, consult the official documentation: <a class="reference external" href="http://wiki.ros.org/urdf/XML/link" rel="noopener noreferrer" target="_blank">Links</a> or <a class="reference external" href="http://wiki.ros.org/urdf/XML/joint" rel="noopener noreferrer" target="_blank">Joints</a>.</p>
</div>
</section>
<section id="minimal-urdf-visual">
<h2>Minimal URDF - Visual<a class="headerlink" href="#minimal-urdf-visual" title="Link to this heading"></a></h2>
<p>With the necessary theoretical background covered, we can now move on to our first robot model. We will use the pre-existing <em>example.urdf</em> file provided in the <code class="docutils literal notranslate"><span class="pre">thymio_description</span></code> package. Navigate to the <em>/urdf/example</em> directory and open the <em>example.urdf</em> file.</p>
<section id="first-link">
<h3>First Link<a class="headerlink" href="#first-link" title="Link to this heading"></a></h3>
<p>Fill the <em>example.urdf</em> file with the first link:</p>
<p>1.Define the structure of the URDF file</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;robot</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<p>This structure specifies the XML format and gives a name to the robot model.</p>
<ol class="arabic simple" start="2">
<li><p>Add a link with visual properties</p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;robot</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;visual&gt;</span>
<span class="w">            </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 0&quot;</span><span class="w">  </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">                </span><span class="nt">&lt;box</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;0.2 0.3 0.6&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">        </span><span class="nt">&lt;/visual&gt;</span>
<span class="w">    </span><span class="nt">&lt;/link&gt;</span>

<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<p>The <strong>base_link</strong> is a standard name for the core element of a robot. Its dimensions are specified in meters. The <strong>origin</strong> uses <strong>xyz</strong> for position and <strong>rpy</strong> (roll, pitch, yaw) for orientation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tags in XML must be opened (e.g. <code class="docutils literal notranslate"><span class="pre">&lt;visual&gt;</span></code>) and closed (e.g. <code class="docutils literal notranslate"><span class="pre">&lt;/visual&gt;</span></code>). If a tag is empty, it can be written as a self-closing tag (e.g. <code class="docutils literal notranslate"><span class="pre">&lt;box</span> <span class="pre">size=&quot;0.2</span> <span class="pre">0.3</span> <span class="pre">0.6&quot;/&gt;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">&lt;box</span> <span class="pre">size=&quot;0.2</span> <span class="pre">0.3</span> <span class="pre">0.6&quot;&gt;</span> <span class="pre">&lt;/box&gt;</span></code>).</p>
</div>
<ol class="arabic simple" start="3">
<li><p>Visualize the box in Rviz</p></li>
</ol>
<p>First, build the package. Since more components will be added shortly, it is convenient to use the <code class="docutils literal notranslate"><span class="pre">--symlink-install</span></code> option for quicker updates.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ros2_basics_ws
colcon<span class="w"> </span>build<span class="w"> </span>--packages-select<span class="w"> </span>thymio_description<span class="w"> </span>--symlink-install
<span class="nb">source</span><span class="w"> </span>install/setup.bash
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This command is useful when working with URDF as it allows you to progressively verify your progress. However, remember to rebuild the package whenever you add a new file.</p>
</div>
<p>Now, we are ready to visualize the result. Use the following command to launch the URDF in Rviz.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>thymio_description<span class="w"> </span>example_display_urdf.launch.xml
</pre></div>
</div>
<p>We have successfully created a box with dimensions: 20 cm in length (x-direction), 30 cm in width (y-direction), and 10 cm in height (z-direction). However, it appears with a default color in Rviz. Let’s modify it to add a custom color.</p>
<ol class="arabic simple" start="4">
<li><p>Add color to the visual</p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;robot</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">rgba=</span><span class="s">&quot;0 0 1 1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/material&gt;</span>

<span class="w">    </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;visual&gt;</span>
<span class="w">            </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 0&quot;</span><span class="w">  </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">                </span><span class="nt">&lt;box</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;0.2 0.3 0.6&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/visual&gt;</span>
<span class="w">    </span><span class="nt">&lt;/link&gt;</span>

<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<p>Colors are defined using the <code class="docutils literal notranslate"><span class="pre">&lt;material&gt;</span></code> tag. A common practice is to define colors at the top of the file and reference them by name in the <code class="docutils literal notranslate"><span class="pre">&lt;visual&gt;</span></code> tag. The color attributes include four arguments: <strong>rgb</strong> for red, green, and blue, and <strong>a</strong> for transparency.</p>
<p>View the result in Rviz using the same command as before (rebuilding the package is not necessary).</p>
</section>
<section id="first-joint">
<h3>First Joint<a class="headerlink" href="#first-joint" title="Link to this heading"></a></h3>
<p>Fill the <em>example.urdf</em> file with the first joint:</p>
<p>To introduce joints, we will add a second link and then connect it to the base link.</p>
<ol class="arabic simple">
<li><p>Define a second link</p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;robot</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">rgba=</span><span class="s">&quot;0 0 1 1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/material&gt;</span>

<span class="w">    </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;visual&gt;</span>
<span class="w">            </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 0&quot;</span><span class="w">  </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">                </span><span class="nt">&lt;box</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;0.2 0.3 0.6&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/visual&gt;</span>
<span class="w">    </span><span class="nt">&lt;/link&gt;</span>

<span class="w">    </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;visual&gt;</span>
<span class="w">            </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">                </span><span class="nt">&lt;cylinder</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;0.8&quot;</span><span class="w"> </span><span class="na">radius=</span><span class="s">&quot;0.05&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/visual&gt;</span>
<span class="w">    </span><span class="nt">&lt;/link&gt;</span>

<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<p>Here, we have simply added a second link with a different shape. The name can be chosen arbitrarily. You can try visualizing it in Rviz.</p>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>The result cannot be visualized yet because unconnected links are not allowed. Let’s resolve this by adding a joint.</p>
</div>
<ol class="arabic simple" start="2">
<li><p>Create a joint between the links</p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;robot</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">rgba=</span><span class="s">&quot;0 0 1 1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/material&gt;</span>

<span class="w">    </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;visual&gt;</span>
<span class="w">            </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 0&quot;</span><span class="w">  </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">                </span><span class="nt">&lt;box</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;0.2 0.3 0.6&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/visual&gt;</span>
<span class="w">    </span><span class="nt">&lt;/link&gt;</span>

<span class="w">    </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;visual&gt;</span>
<span class="w">            </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">                </span><span class="nt">&lt;cylinder</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;0.8&quot;</span><span class="w"> </span><span class="na">radius=</span><span class="s">&quot;0.05&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/visual&gt;</span>
<span class="w">    </span><span class="nt">&lt;/link&gt;</span>

<span class="w">    </span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link_joint&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;fixed&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;parent</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;base_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;second_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/joint&gt;</span>

<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<p>The second link has been added. Use a naming convention for the joint that makes it easy to identify. As mentioned earlier, a joint is defined by its <strong>type</strong>, <strong>parent link</strong>, and <strong>child link</strong>. Additionally, it includes an <strong>origin</strong>, which specifies its position and orientation relative to the parent link. Now, let’s visualize this in Rviz.</p>
<ol class="arabic simple" start="3">
<li><p>Set the origins</p></li>
</ol>
<p>We have not discussed origins yet, as they can be a bit confusing when working with URDF for the first time. To simplify, we will provide a straightforward approach to correctly position your links. This step is critical for creating a robot model that works accurately in simulation.</p>
<p>As mentioned earlier, ROS2 uses the URDF file to generate the robot’s TFs. If the joints are not properly placed, the TFs will also be misaligned, leading to unexpected behavior during simulation.</p>
<p>Let’s go through a simple four-step process to correctly position two links. Currently, our setup looks like this:</p>
<a class="reference internal image-reference" href="_images/urdf_step1.png"><img alt="_images/urdf_step1.png" class="align-center" src="_images/urdf_step1.png" style="width: 25%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<p>Our goal now is to replicate this:</p>
<a class="reference internal image-reference" href="_images/urdf_step4b.png"><img alt="_images/urdf_step4b.png" class="align-center" src="_images/urdf_step4b.png" style="width: 50%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<p>For each of the following steps, observe the provided code and its corresponding visualization in Rviz. Carefully review the changes and reflect on the purpose of each origin setting. If you have any questions, feel free to ask. It is crucial to understand this process as you will need to apply it when building the Thymio model yourself.</p>
<div class="admonition-procedure admonition">
<p class="admonition-title">Procedure</p>
<ol class="arabic simple">
<li><p>Set all origins to zero (this is already the case)</p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="_images/urdf_step1.png"><img alt="_images/urdf_step1.png" src="_images/urdf_step1.png" style="width: 20%;" />
</a>
<figcaption>
<p><span class="caption-text"><cite>Step 1 - Initialization</cite></span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><div style="margin-top: 5px;"></div></p>
<ol class="arabic simple" start="2">
<li><p>Set the origin for the <code class="docutils literal notranslate"><span class="pre">&lt;visual&gt;</span></code> tag of the <code class="docutils literal notranslate"><span class="pre">base_link</span></code></p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;visual&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 0.3&quot;</span><span class="w">  </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;box</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;0.2 0.3 0.6&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">        </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/visual&gt;</span>
<span class="nt">&lt;/link&gt;</span>
</pre></div>
</div>
<figure class="align-center" id="id6">
<a class="reference internal image-reference" href="_images/urdf_step2.png"><img alt="_images/urdf_step2.png" src="_images/urdf_step2.png" style="width: 20%;" />
</a>
<figcaption>
<p><span class="caption-text"><cite>Step 2 - Position parent link</cite></span><a class="headerlink" href="#id6" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><div style="margin-top: 5px;"></div></p>
<ol class="arabic simple" start="3">
<li><p>Set the joint origin</p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link_joint&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;fixed&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;parent</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;base_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;second_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0.1 0 0.3&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/joint&gt;</span>
</pre></div>
</div>
<figure class="align-center" id="id7">
<a class="reference internal image-reference" href="_images/urdf_step3.png"><img alt="_images/urdf_step3.png" src="_images/urdf_step3.png" style="width: 20%;" />
</a>
<figcaption>
<p><span class="caption-text"><cite>Step 3 - Position the joint</cite></span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><div style="margin-top: 5px;"></div></p>
<ol class="arabic simple" start="4">
<li><p>Set the origin for the <code class="docutils literal notranslate"><span class="pre">&lt;visual&gt;</span></code> of the <code class="docutils literal notranslate"><span class="pre">second_link</span></code></p></li>
</ol>
<ol class="loweralpha simple">
<li><p>Rotation</p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;visual&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 1.57 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;cylinder</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;0.8&quot;</span><span class="w"> </span><span class="na">radius=</span><span class="s">&quot;0.05&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">        </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/visual&gt;</span>
<span class="nt">&lt;/link&gt;</span>
</pre></div>
</div>
<figure class="align-center" id="id8">
<a class="reference internal image-reference" href="_images/urdf_step4a.png"><img alt="_images/urdf_step4a.png" src="_images/urdf_step4a.png" style="width: 30%;" />
</a>
<figcaption>
<p><span class="caption-text"><cite>Step 4.a - Orient the child link</cite></span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><div style="margin-top: 5px;"></div></p>
<ol class="loweralpha simple" start="2">
<li><p>Translation</p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;visual&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0.4 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 1.57 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;cylinder</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;0.8&quot;</span><span class="w"> </span><span class="na">radius=</span><span class="s">&quot;0.05&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">        </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/visual&gt;</span>
<span class="nt">&lt;/link&gt;</span>
</pre></div>
</div>
<figure class="align-center" id="id9">
<a class="reference internal image-reference" href="_images/urdf_step4b.png"><img alt="_images/urdf_step4b.png" src="_images/urdf_step4b.png" style="width: 40%;" />
</a>
<figcaption>
<p><span class="caption-text"><cite>Step 4.b - Position the child link</cite></span><a class="headerlink" href="#id9" title="Link to this image"></a></p>
</figcaption>
</figure>
</div>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p>Which origin setting is most critical for ensuring that your robot’s movements and positions are accurately represented in ROS2 simulations?</p>
</div>
<ol class="arabic simple" start="4">
<li><p>Explore the different joint types</p></li>
</ol>
<p>Now, let’s experiment with the two links by trying out different joint types. Simply replace the existing joint with one of the examples below. For each joint type, visualize the result in Rviz and use the Joint State Publisher GUI to observe how the parts move.</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><strong>Revolute</strong> - Rotation around a single axis within a defined range</p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link_joint&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;revolute&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;parent</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;base_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;second_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0.1 0 0.3&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;axis</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;1 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;limit</span><span class="w"> </span><span class="na">lower=</span><span class="s">&quot;-1.57&quot;</span><span class="w"> </span><span class="na">upper=</span><span class="s">&quot;1.57&quot;</span><span class="w"> </span><span class="na">velocity=</span><span class="s">&quot;10&quot;</span><span class="w"> </span><span class="na">effort=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/joint&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p><strong>Continuous</strong> - Rotation around a single axis without limits</p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link_joint&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;continuous&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;parent</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;base_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;second_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0.1 0 0.3&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;axis</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;1 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/joint&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p><strong>Prismatic</strong> - Linear motion along a single axis</p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link_joint&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;prismatic&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;parent</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;base_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;second_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0.1 0 0.3&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;axis</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;1 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;limit</span><span class="w"> </span><span class="na">lower=</span><span class="s">&quot;0.0&quot;</span><span class="w"> </span><span class="na">upper=</span><span class="s">&quot;0.5&quot;</span><span class="w"> </span><span class="na">velocity=</span><span class="s">&quot;10&quot;</span><span class="w"> </span><span class="na">effort=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/joint&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>Reaching this point means you now have a better understanding of what a URDF is. You are equipped with the essential tools to finally practice building your first robot model on your own. Let’s get started!</p>
</section>
<section id="thymio-step-1">
<h3>Thymio - Step 1<a class="headerlink" href="#thymio-step-1" title="Link to this heading"></a></h3>
<p>As mentioned in the introduction, today’s goal is to create a Thymio model that works well in simulation. The task is divided into 6 steps, and the journey begins now with your first challenge: creating the visual representation of the Thymio using the tools just introduced.</p>
<div class="admonition-thymio admonition">
<p class="admonition-title">Thymio</p>
<p>Start by creating a new file named <em>thymio.urdf</em> in the <em>/urdf/thymio</em> directory. Follow the provided specifications to guide you through the process. Make sure to frequently visualize your progress in Rviz using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>thymio_description<span class="w"> </span>thymio_display_urdf.launch.xml
</pre></div>
</div>
<div class="table-centered"><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Component</p></th>
<th class="head"><p>Specifications</p></th>
<th class="head"><p>Color</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Base link</strong></p></td>
<td><p><em>Box:</em>
Length = 11 cm |
Width = 11.2 cm |
Height = 4.4 cm
<div style="margin-top: 5px;"></div>
<em>Ground clearance:</em> 4.5 mm</p></td>
<td><p>White</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Caster wheel</strong></p></td>
<td><p><em>Sphere:</em>
Radius = 9 mm</p></td>
<td><p>White</p></td>
</tr>
<tr class="row-even"><td><p><strong>Wheels</strong></p></td>
<td><p><em>Cylinder:</em>
Length = 1.5 cm |
Radius = 2.2 cm</p></td>
<td><p>Black</p></td>
</tr>
</tbody>
</table>
</div><p>Refer to the following drawing to correctly place the different links:</p>
<a class="reference internal image-reference" href="_images/thymio_spec.png"><img alt="_images/thymio_spec.png" class="align-center" src="_images/thymio_spec.png" style="width: 60%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<div class="admonition-hints admonition">
<p class="admonition-title">Hints</p>
<div class="toggle docutils container">
<ul class="simple">
<li><p>The ground clearance information should be sufficient to define all the heights</p></li>
<li><p>Carefully consider where the TFs should be positioned (this is crucial!)</p></li>
<li><p>The final visual result should look like this:</p></li>
</ul>
<a class="reference internal image-reference" href="_images/thymio_look.png"><img alt="_images/thymio_look.png" class="align-center" src="_images/thymio_look.png" style="width: 60%;" />
</a>
</div>
</div>
</div>
</section>
</section>
<section id="improved-urdf-xacro">
<h2>Improved URDF - Xacro<a class="headerlink" href="#improved-urdf-xacro" title="Link to this heading"></a></h2>
<p>Congratulations on completing the simplified Thymio model! Now, to prepare for the next step, consider this question: <strong>What happens if we change the dimensions of the base_link?</strong></p>
<p>Try answering this by modifying the width of the <code class="docutils literal notranslate"><span class="pre">base_link</span></code> to 6.6 cm instead of 11.2 cm.</p>
<p>You will notice that the wheels are no longer correctly aligned with the sides of the <code class="docutils literal notranslate"><span class="pre">base_link</span></code>. This is because the current URDF uses hardcoded values. Any change to one dimension requires manual updates to other dependent dimensions. While manageable for a small file, this approach is likely to cause mistakes and become inefficient for larger models.</p>
<p>In programming, this problem is typically solved by using variables to define relationships between dimensions, ensuring automatic updates when one value changes. While URDF does not support variables, <strong>Xacro</strong>, an extension of URDF, solves this issue. Xacro allows for:</p>
<ul class="simple">
<li><p><strong>Parametrization</strong>: Define variables for dynamic adjustments.</p></li>
<li><p><strong>Simplification</strong>: Use macros, constants, math operations, and conditional logic.</p></li>
<li><p><strong>Modularity</strong>: Organize your robot description into multiple files.</p></li>
</ul>
<p>Therefore, a URDF can be rewritten using Xacro’s extended syntax, allowing it to be organized across one or multiple files. These files are then processed by a <em>xacro</em> tool which combines them into a single, standard URDF file that ROS2 can interpret. Let’s apply this to our example and see how it works in practice.</p>
<ol class="arabic simple">
<li><p>Open <em>example.urdf.xacro</em> and <em>example_materials.xacro</em></p></li>
</ol>
<p>Navigate to the <em>/urdf/example</em> directory and open the provided files with the <em>.xacro</em> extension.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To enhance understanding, we will go through the elements of the updated file step by step. You do not need to add these elements to the file yet, as the complete file will be provided at the end. Focus on understanding the process and the purpose of each element.</p>
</div>
<ol class="arabic simple" start="2">
<li><p>Xacro compatibility</p></li>
</ol>
<p>To enable the use of xacro in our file, we need to adjust the <code class="docutils literal notranslate"><span class="pre">&lt;robot&gt;</span></code> tag as follow:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;robot</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;example&quot;</span><span class="w"> </span><span class="na">xmlns:xacro=</span><span class="s">&quot;http://wwww.ros.org/wiki/xacro&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Mathematical operations</p></li>
</ol>
<p>Xacro enables various mathematical operations, including the use of the constant pi, often needed for adjusting link orientations. For example, the <code class="docutils literal notranslate"><span class="pre">second_link</span></code> origin can be rewritten as:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0.4 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 ${pi / 2.0} 0&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Variables</p></li>
</ol>
<p>Variables can be defined like this:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link_length&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.2&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;xacro:property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link_width&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.3&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;xacro:property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link_height&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.6&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>And used as shown here:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;box</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;${base_link_length} ${base_link_width} ${base_link_height}&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Macros</p></li>
</ol>
<p>Xacro supports defining reusable functions called macros. For example, a macro to define a box with length, width, and height as parameters can be written as:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:macro</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;box&quot;</span><span class="w"> </span><span class="na">params=</span><span class="s">&quot;length width height&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;box</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;${length} ${width} ${height}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/xacro:macro&gt;</span>
</pre></div>
</div>
<p>You can then call it at the desired location with the required parameters:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:box</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;${base_link_length}&quot;</span><span class="w"> </span><span class="na">width=</span><span class="s">&quot;${base_link_width}&quot;</span><span class="w"> </span><span class="na">height=</span><span class="s">&quot;${base_link_height}&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>Multiple files</p></li>
</ol>
<p>To simplify the process, it is a good practice to split the URDF into multiple files. Typically, one main file includes all other Xacro files. To distinguish them, use the extension <em>.urdf.xacro</em> for the main file and <em>.xacro</em> for the others.</p>
<p>For example, materials can be defined in a separate file for clarity and reuse. This allows the main file to stay focused on the robot’s structure. The new file follows the same structure as the main file but does not include a robot name:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;robot</span><span class="w"> </span><span class="na">xmlns:xacro=</span><span class="s">&quot;http://wwww.ros.org/wiki/xacro&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">rgba=</span><span class="s">&quot;0 0 1 1&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/material&gt;</span>

<span class="w">    </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;green&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">rgba=</span><span class="s">&quot;0 1 0 1&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/material&gt;</span>

<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<p>This file contains reusable material definitions that can now be included in other Xacro files using the <code class="docutils literal notranslate"><span class="pre">&lt;xacro:include&gt;</span></code> tag, as shown below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:include</span><span class="w"> </span><span class="na">filename=</span><span class="s">&quot;example_materials.xacro&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When including multiple files:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:include</span><span class="w"> </span><span class="na">filename=</span><span class="s">&quot;file1.xacro&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;xacro:include</span><span class="w"> </span><span class="na">filename=</span><span class="s">&quot;file2.xacro&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>The second file can use variables or materials defined in the first file because it is included beforehand. You do not need to re-include <em>file1.xacro</em> in <em>file2.xacro</em>.</p>
</div>
<ol class="arabic simple" start="7">
<li><p>Update the files</p></li>
</ol>
<ol class="loweralpha simple">
<li><p>Update <em>example_materials.xacro</em></p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;robot</span><span class="w"> </span><span class="na">xmlns:xacro=</span><span class="s">&quot;http://wwww.ros.org/wiki/xacro&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">rgba=</span><span class="s">&quot;0 0 1 1&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/material&gt;</span>

<span class="w">    </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;green&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;color</span><span class="w"> </span><span class="na">rgba=</span><span class="s">&quot;0 1 0 1&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/material&gt;</span>

<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<ol class="loweralpha simple" start="2">
<li><p>Update <em>example.urdf.xacro</em> file</p></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;robot</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;example&quot;</span><span class="w"> </span><span class="na">xmlns:xacro=</span><span class="s">&quot;http://wwww.ros.org/wiki/xacro&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;xacro:include</span><span class="w"> </span><span class="na">filename=</span><span class="s">&quot;example_materials.xacro&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;xacro:property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link_length&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.2&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xacro:property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link_width&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.3&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xacro:property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link_height&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.6&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xacro:property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link_length&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.8&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xacro:property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link_radius&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.05&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;xacro:macro</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;box&quot;</span><span class="w"> </span><span class="na">params=</span><span class="s">&quot;length width height&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;box</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;${length} ${width} ${height}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xacro:macro&gt;</span>

<span class="w">    </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;visual&gt;</span>
<span class="w">            </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 ${base_link_height / 2.0}&quot;</span><span class="w">  </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">                </span><span class="nt">&lt;xacro:box</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;${base_link_length}&quot;</span><span class="w"> </span><span class="na">width=</span><span class="s">&quot;${base_link_width}&quot;</span><span class="w"> </span><span class="na">height=</span><span class="s">&quot;${base_link_height}&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;green&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/visual&gt;</span>
<span class="w">    </span><span class="nt">&lt;/link&gt;</span>

<span class="w">    </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;visual&gt;</span>
<span class="w">            </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;${second_link_length / 2.0} 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 ${pi / 2.0} 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">                </span><span class="nt">&lt;cylinder</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;${second_link_length}&quot;</span><span class="w"> </span><span class="na">radius=</span><span class="s">&quot;${second_link_radius}&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/visual&gt;</span>
<span class="w">    </span><span class="nt">&lt;/link&gt;</span>

<span class="w">    </span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link_joint&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;fixed&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;parent</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;base_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;second_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;${base_link_length / 2.0} 0 ${base_link_height / 2.0}&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/joint&gt;</span>

<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice that the file no longer contains hardcoded values. Instead, five variables are used to define the links and joint accurately. While using a macro to define a single box may be excessive here, it serves to demonstrate how macros work.</p>
</div>
<ol class="arabic simple" start="8">
<li><p>Visualize the result in Rviz</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>thymio_description<span class="w"> </span>example_display_xacro.launch.xml
</pre></div>
</div>
<section id="thymio-step-2">
<h3>Thymio - Step 2<a class="headerlink" href="#thymio-step-2" title="Link to this heading"></a></h3>
<div class="admonition-thymio admonition">
<p class="admonition-title">Thymio</p>
<p>Let’s put this knowledge into practice. The goal is to enhance the previous URDF by utilizing Xacro’s features. Follow these steps:</p>
<ol class="arabic">
<li><p>Split the URDF into three files:</p>
<blockquote>
<div><ul class="simple">
<li><p><em>materials.xacro</em>: Defines the colors</p></li>
<li><p><em>thymio_chassis.xacro</em>: Contains the description of the robot</p></li>
<li><p><em>thymio.urdf.xacro</em>: The main file that includes the other two files</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Use the pi constant where needed</p></li>
<li><p>Define variables and replace hardcoded values</p></li>
<li><p>Create a macro for the wheel links and reuse it for both wheels</p></li>
</ol>
<p>Additionally, remember to apply mathematical operations wherever possible.</p>
<p>Use the following command to display the new model:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>thymio_description<span class="w"> </span>thymio_display_xacro.launch.xml
</pre></div>
</div>
<p>Once again, refer to the drawing below for the key dimensions:</p>
<a class="reference internal image-reference" href="_images/thymio_spec.png"><img alt="_images/thymio_spec.png" class="align-center" src="_images/thymio_spec.png" style="width: 60%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<div class="admonition-hints admonition">
<p class="admonition-title">Hints</p>
<div class="toggle docutils container">
<ul class="simple">
<li><p>Eight variables are sufficient to define all links and joints: <code class="docutils literal notranslate"><span class="pre">base_length</span></code>, <code class="docutils literal notranslate"><span class="pre">base_width</span></code>, <code class="docutils literal notranslate"><span class="pre">base_height</span></code>, <code class="docutils literal notranslate"><span class="pre">ground_clearance</span></code>, <code class="docutils literal notranslate"><span class="pre">caster_wheel_radius</span></code>, <code class="docutils literal notranslate"><span class="pre">wheel_radius</span></code>, <code class="docutils literal notranslate"><span class="pre">wheel_width</span></code>, <code class="docutils literal notranslate"><span class="pre">wheel_offset</span></code></p></li>
<li><p>Some variables can depend on others</p></li>
<li><p>Position the caster wheel and wheels relative to the base’s length and width</p></li>
<li><p>The final visual, with the <code class="docutils literal notranslate"><span class="pre">base_length</span></code> increased and the <code class="docutils literal notranslate"><span class="pre">base_width</span></code> reduced by a factor of two, should appear as follows:</p></li>
</ul>
<a class="reference internal image-reference" href="_images/thymio_xacro.png"><img alt="_images/thymio_xacro.png" class="align-center" src="_images/thymio_xacro.png" style="width: 60%;" />
</a>
</div>
</div>
</div>
</section>
</section>
<section id="gazebo-overview">
<h2>Gazebo Overview<a class="headerlink" href="#gazebo-overview" title="Link to this heading"></a></h2>
<p>Now, let’s take the next step and introduce simulation into our workflow using <strong>Gazebo</strong>. Gazebo is a <strong>physics-based simulation tool</strong> that integrates with ROS2 to provide:</p>
<ul class="simple">
<li><p>A virtual environment for testing robot behaviors</p></li>
<li><p>Accurate simulations of physical interactions and sensor outputs</p></li>
</ul>
<p>Simulation is an essential part of robotics development for several reasons:</p>
<ul class="simple">
<li><p><strong>Algorithm testing</strong>: Optimizes control algorithms in a repeatable, controlled environment</p></li>
<li><p><strong>Physical interactions</strong>: Models collisions, dynamics, gravity, inertia, and sensor noise</p></li>
<li><p><strong>Sensors and actuators simulation</strong>: Provides sensor data and enables actuator control</p></li>
</ul>
<p>Gazebo is an independent tool and not a native part of the ROS2 environment. However, it integrates with ROS2 using the <em>gazebo_ros</em> package, which acts as a bridge between the two. This integration is made possible through various Gazebo plugins that allow interaction with the ROS2 ecosystem and simulation of robot hardware, including actuators and sensors.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To clarify the differences between <strong>Rviz</strong> and <strong>Gazebo</strong>, here is a summary table:</p>
<div class="table-centered"><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Feature</strong></p></th>
<th class="head"><p><strong>Rviz</strong></p></th>
<th class="head"><p><strong>Gazebo</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Purpose</strong></p></td>
<td><p>3D visualization tool for</p>
<p>monitoring robot state</p>
</td>
<td><p>Simulation tool that models</p>
<p>real-world physical properties</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Control</strong></p></td>
<td><p>No control capabilities</p>
<p>(purely visualization)</p>
</td>
<td><p>Provides control functionalities</p></td>
</tr>
<tr class="row-even"><td><p><strong>Use Case</strong></p></td>
<td><p>Debugging and analyzing</p>
<p>robot data</p>
</td>
<td><p>Simulating and testing robots in</p>
<p>a realistic environment</p>
</td>
</tr>
</tbody>
</table>
</div></div>
</section>
<section id="complete-urdf-collision-inertial">
<h2>Complete URDF - Collision &amp; Inertial<a class="headerlink" href="#complete-urdf-collision-inertial" title="Link to this heading"></a></h2>
<p>So far, we have been focusing exclusively on the visual representation of the Thymio robot. To make the model functional in a simulation, the URDF must be updated to include collision and physical properties. These additions will enable the robot to interact realistically with the virtual environment. Let’s begin by incorporating the collision properties.</p>
<section id="collision-tags">
<h3>Collision Tags<a class="headerlink" href="#collision-tags" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Launch our basic example in Rviz</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>thymio_description<span class="w"> </span>example_display_xacro.launch.xml
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Adjust the Rviz configuration</p></li>
</ol>
<p>Under the <code class="docutils literal notranslate"><span class="pre">RobotModel</span></code> options, uncheck <em>Visual Enabled</em> and check <em>Collision Enabled</em>. You will see that nothing appear. In fact, this is normal, we have not defined the collision properties yet.</p>
<ol class="arabic simple" start="3">
<li><p>Update <em>example.urdf.xacro</em></p></li>
</ol>
<p>To add collision properties to the links in the URDF, you need to include <code class="docutils literal notranslate"><span class="pre">&lt;collision&gt;</span></code> tags. These are similar to <code class="docutils literal notranslate"><span class="pre">&lt;visual&gt;</span></code> tags: both require an origin and a geometry. However, <code class="docutils literal notranslate"><span class="pre">&lt;collision&gt;</span></code> tags do <strong>not</strong> require a material definition.</p>
<p>Please update the file, which now includes the collision properties for the links:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;visual&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 ${base_link_height / 2.0}&quot;</span><span class="w">  </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;xacro:box</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;${base_link_length}&quot;</span><span class="w"> </span><span class="na">width=</span><span class="s">&quot;${base_link_width}&quot;</span><span class="w"> </span><span class="na">height=</span><span class="s">&quot;${base_link_height}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">        </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;green&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/visual&gt;</span>
<span class="w">    </span><span class="nt">&lt;collision&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 ${base_link_height / 2.0}&quot;</span><span class="w">  </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;xacro:box</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;${base_link_length}&quot;</span><span class="w"> </span><span class="na">width=</span><span class="s">&quot;${base_link_width}&quot;</span><span class="w"> </span><span class="na">height=</span><span class="s">&quot;${base_link_height}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">    </span><span class="nt">&lt;/collision&gt;</span>
<span class="nt">&lt;/link&gt;</span>

<span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;visual&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;${second_link_length / 2.0} 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 ${pi / 2.0} 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;cylinder</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;${second_link_length}&quot;</span><span class="w"> </span><span class="na">radius=</span><span class="s">&quot;${second_link_radius}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">        </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/visual&gt;</span>
<span class="w">    </span><span class="nt">&lt;collision&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;${second_link_length / 2.0} 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 ${pi / 2.0} 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;cylinder</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;${second_link_length}&quot;</span><span class="w"> </span><span class="na">radius=</span><span class="s">&quot;${second_link_radius}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">    </span><span class="nt">&lt;/collision&gt;</span>
<span class="nt">&lt;/link&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Verify the result in Rviz</p></li>
</ol>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p>Is the geometry defined in the <code class="docutils literal notranslate"><span class="pre">&lt;collision&gt;</span></code> tag always identical to the visual geometry? You can base your reflection on the following example. Think about why they might differ and how this affects simulation and robot interactions.</p>
<a class="reference internal image-reference" href="_images/BlockBuster.png"><img alt="_images/BlockBuster.png" class="align-center" src="_images/BlockBuster.png" style="width: 65%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
</div>
</section>
<section id="inertial-tags">
<h3>Inertial Tags<a class="headerlink" href="#inertial-tags" title="Link to this heading"></a></h3>
<p>Now, let’s focus on defining the physical properties of the model by adding the <code class="docutils literal notranslate"><span class="pre">&lt;inertial&gt;</span></code> tags. These tags play a crucial role in accurately simulating the robot’s motion by specifying properties such as mass and moments of inertia. This ensures the model responds realistically to forces like gravity and other dynamics.</p>
<p>As you may recall from your physics courses, the formulas for the moment of inertia tensor are well-established for basic geometric shapes. These tensors are uniquely determined by the object’s dimensions and mass. Let’s explore how to incorporate these inertia properties.</p>
<ol class="arabic simple">
<li><p>Open the <em>example_inertia.xacro</em> file</p></li>
</ol>
<p>In the <em>/urdf/example</em> directory, locate the provided <em>example_inertia.xacro</em> file. This file will be used to define reusable macros for the inertia properties of our basic shapes.</p>
<ol class="arabic simple" start="2">
<li><p>Add the inertia macros to the file</p></li>
</ol>
<p>Like the other tags we have encountered, the <code class="docutils literal notranslate"><span class="pre">&lt;inertial&gt;</span></code> tag requires an origin to be defined. In addition, it needs a mass and an inertia matrix. Since this matrix is symmetric, only 6 of its 9 components need to be specified. You can consult the formulas for defining inertia matrices in the corresponding Wikipedia webpage: <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_moments_of_inertia#List_of_3D_inertia_tensors" rel="noopener noreferrer" target="_blank">List of 3D inertia tensors</a>.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;robot</span><span class="w"> </span><span class="na">xmlns:xacro=</span><span class="s">&quot;http://www.ros.org/wiki/xacro&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;xacro:macro</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;box_inertia&quot;</span><span class="w"> </span><span class="na">params=</span><span class="s">&quot;m l w h xyz rpy&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;inertial&gt;</span>
<span class="w">            </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;${xyz}&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;${rpy}&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;mass</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${m}&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;inertia</span><span class="w"> </span><span class="na">ixx=</span><span class="s">&quot;${(m/12) * (h*h + l*l)}&quot;</span><span class="w"> </span><span class="na">ixy=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">ixz=</span><span class="s">&quot;0&quot;</span>
<span class="w">                    </span><span class="na">iyy=</span><span class="s">&quot;${(m/12) * (w*w + l*l)}&quot;</span><span class="w"> </span><span class="na">iyz=</span><span class="s">&quot;0&quot;</span>
<span class="w">                    </span><span class="na">izz=</span><span class="s">&quot;${(m/12) * (w*w + h*h)}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/inertial&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xacro:macro&gt;</span>

<span class="w">    </span><span class="nt">&lt;xacro:macro</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;cylinder_inertia&quot;</span><span class="w"> </span><span class="na">params=</span><span class="s">&quot;m r h xyz rpy&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;inertial&gt;</span>
<span class="w">            </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;${xyz}&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;${rpy}&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;mass</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${m}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;inertia</span><span class="w"> </span><span class="na">ixx=</span><span class="s">&quot;${(m/12) * (3*r*r + h*h)}&quot;</span><span class="w"> </span><span class="na">ixy=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">ixz=</span><span class="s">&quot;0&quot;</span>
<span class="w">                    </span><span class="na">iyy=</span><span class="s">&quot;${(m/12) * (3*r*r + h*h)}&quot;</span><span class="w"> </span><span class="na">iyz=</span><span class="s">&quot;0&quot;</span>
<span class="w">                    </span><span class="na">izz=</span><span class="s">&quot;${(m/2) * (r*r)}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/inertial&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xacro:macro&gt;</span>

<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Adjust <em>example.urdf.xacro</em></p></li>
</ol>
<p>To use the defined macros, include the previously created file and invoke them with the desired parameters.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:include</span><span class="w"> </span><span class="na">filename=</span><span class="s">&quot;example_inertia.xacro&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;xacro:property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link_mass&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.5&quot;</span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- Mass in [kg] --&gt;</span>
<span class="nt">&lt;xacro:property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link_mass&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.2&quot;</span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- Mass in [kg] --&gt;</span>

<span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_link&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;visual&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 ${base_link_height / 2.0}&quot;</span><span class="w">  </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;xacro:box</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;${base_link_length}&quot;</span><span class="w"> </span><span class="na">width=</span><span class="s">&quot;${base_link_width}&quot;</span><span class="w"> </span><span class="na">height=</span><span class="s">&quot;${base_link_height}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">        </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;green&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/visual&gt;</span>
<span class="w">    </span><span class="nt">&lt;collision&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0 0 ${base_link_height / 2.0}&quot;</span><span class="w">  </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;xacro:box</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;${base_link_length}&quot;</span><span class="w"> </span><span class="na">width=</span><span class="s">&quot;${base_link_width}&quot;</span><span class="w"> </span><span class="na">height=</span><span class="s">&quot;${base_link_height}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">    </span><span class="nt">&lt;/collision&gt;</span>
<span class="w">    </span><span class="nt">&lt;xacro:box_inertia</span><span class="w"> </span><span class="na">m=</span><span class="s">&quot;${base_link_mass}&quot;</span><span class="w"> </span><span class="na">l=</span><span class="s">&quot;${base_link_length}&quot;</span><span class="w"> </span><span class="na">w=</span><span class="s">&quot;${base_link_width}&quot;</span><span class="w"> </span><span class="na">h=</span><span class="s">&quot;${base_link_height}&quot;</span>
<span class="w">                       </span><span class="na">xyz=</span><span class="s">&quot;0 0 ${base_link_height / 2.0}&quot;</span><span class="w">  </span><span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/link&gt;</span>

<span class="nt">&lt;link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second_link&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;visual&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;${second_link_length / 2.0} 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 ${pi / 2.0} 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;cylinder</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;${second_link_length}&quot;</span><span class="w"> </span><span class="na">radius=</span><span class="s">&quot;${second_link_radius}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">        </span><span class="nt">&lt;material</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/visual&gt;</span>
<span class="w">    </span><span class="nt">&lt;collision&gt;</span>
<span class="w">        </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;${second_link_length / 2.0} 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 ${pi / 2.0} 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;geometry&gt;</span>
<span class="w">            </span><span class="nt">&lt;cylinder</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;${second_link_length}&quot;</span><span class="w"> </span><span class="na">radius=</span><span class="s">&quot;${second_link_radius}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/geometry&gt;</span>
<span class="w">    </span><span class="nt">&lt;/collision&gt;</span>
<span class="w">    </span><span class="nt">&lt;xacro:cylinder_inertia</span><span class="w"> </span><span class="na">m=</span><span class="s">&quot;${second_link_mass}&quot;</span><span class="w"> </span><span class="na">r=</span><span class="s">&quot;${second_link_radius}&quot;</span><span class="w"> </span><span class="na">h=</span><span class="s">&quot;${second_link_length}&quot;</span>
<span class="w">                            </span><span class="na">xyz=</span><span class="s">&quot;${second_link_length / 2.0} 0 0&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 ${pi / 2.0} 0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/link&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are interested, you can visualize the result in Rviz (<em>RobotModel &gt; Mass Properties &gt; Inertia</em>), but this method is not ideal for intuitively verifying the correctness of our implementation. Instead, we recommend testing the physical behavior directly in Gazebo. However, as we do not yet have all the necessary tools, we will revisit this step later.</p>
</div>
</section>
<section id="thymio-step-3">
<h3>Thymio - Step 3<a class="headerlink" href="#thymio-step-3" title="Link to this heading"></a></h3>
<div class="admonition-thymio admonition">
<p class="admonition-title">Thymio</p>
<p>The new task is to enhance the current Thymio model by adding <code class="docutils literal notranslate"><span class="pre">&lt;collision&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;inertial&gt;</span></code> tags. Follow the provided specifications carefully.</p>
<div class="table-centered"><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Component</strong></p></th>
<th class="head"><p><strong>Specification</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>Total mass</em></p></td>
<td><p><em>270 g</em></p></td>
</tr>
<tr class="row-odd"><td><p>Wheels</p></td>
<td><p>20% of total mass</p></td>
</tr>
<tr class="row-even"><td><p>Chassis
<div style="margin-top: 5px;"></div>
┣━ Base_link</p>
<p>┗━ Caster wheel</p>
</td>
<td><p>80% of total mass
<div style="margin-top: 5px;"></div>
95% of chassis mass</p>
<p>5% of chassis mass</p>
</td>
</tr>
</tbody>
</table>
</div></div>
</section>
</section>
<section id="spawn-robot-in-gazebo">
<h2>Spawn Robot in Gazebo<a class="headerlink" href="#spawn-robot-in-gazebo" title="Link to this heading"></a></h2>
<p>Your Thymio robot is now set up and ready for simulation testing. Launch it in Gazebo using the command below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>thymio_description<span class="w"> </span>thymio_gazebo.launch.xml
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Gazebo may occasionally crash when started. If this happens, terminate the launch process by pressing <code class="docutils literal notranslate"><span class="pre">Ctrl+C</span></code> and try again. This should resolve the issue.</p>
</div>
<p>In Gazebo, experiment with the physics to observe the robot’s behavior:</p>
<ul class="simple">
<li><p><em>Translation</em>: Press <code class="docutils literal notranslate"><span class="pre">T</span></code>, click the robot, and drag to move or lift it. Try to make it fall.</p></li>
<li><p><em>Rotation</em>: Press <code class="docutils literal notranslate"><span class="pre">R</span></code>, click the robot, and rotate or tilt it. Observe how it stabilizes.</p></li>
</ul>
<p>After exploring the physics, go back to the URDF file. Comment out the <code class="docutils literal notranslate"><span class="pre">&lt;collision&gt;</span></code> tag for the wheel links, save the changes, and relaunch the simulation.</p>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p>What do you observe? How does the absence of a collision property affect the robot’s interaction with its environment?</p>
</div>
<p>After addressing this question, revisit the URDF file, restore the <code class="docutils literal notranslate"><span class="pre">&lt;collision&gt;</span></code> tag, and now comment out the <code class="docutils literal notranslate"><span class="pre">&lt;inertial&gt;</span></code> tag for the wheels. Save your changes and relaunch the simulation.</p>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p>How does the behavior differ this time? Why do you think this occurs?</p>
</div>
<p>When finished, restore the URDF file to its original state. If you carefully observed the simulation results, you may have noticed two issues:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The Thymio moves slightly on its own after spawning</p></li>
<li><p>Colors are missing in Gazebo</p></li>
</ol>
</div></blockquote>
<p>Let’s tackle these one by one. The unexpected motion occurs because the simplified Thymio model lacks accurate inertia properties and precise mass values. To resolve this, we will adjust the dynamics of the wheel joints and reduce the friction of the caster wheel.</p>
<div class="admonition-procedure admonition">
<p class="admonition-title">Procedure</p>
<ol class="arabic simple">
<li><p>Modify the wheel joint dynamics</p></li>
</ol>
<p>For each wheel joint, add the following line:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dynamics</span><span class="w"> </span><span class="na">damping=</span><span class="s">&quot;0.1&quot;</span><span class="w"> </span><span class="na">friction=</span><span class="s">&quot;0.2&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Create a <em>gazebo.xacro</em></p></li>
</ol>
<p>Gazebo provides specific <code class="docutils literal notranslate"><span class="pre">&lt;gazebo&gt;</span></code> tags to define simulation properties. To keep things organized, create a new Xacro file, <em>gazebo.xacro</em>, where we will add all Gazebo-specific properties.</p>
<ol class="arabic simple" start="3">
<li><p>Reduce the caster wheel friction</p></li>
</ol>
<p>The caster wheel in the current robot model adds too much friction and drags against the ground. To address this, add the following friction coefficients to the <em>gazebo.xacro</em> file:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gazebo</span><span class="w"> </span><span class="na">reference=</span><span class="s">&quot;caster_wheel_link&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;mu1</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.31&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;mu2</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.31&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/gazebo&gt;</span>
</pre></div>
</div>
<p>Do not forget to include <em>gazebo.xacro</em> in the <em>thymio.urdf.xacro</em> file to ensure the simulation properties are applied.</p>
<p>After making these adjustments, the Thymio should remain stationary after spawning in Gazebo. Test the simulation to confirm the changes.</p>
</div>
<p>To address the missing colors, we can use <code class="docutils literal notranslate"><span class="pre">&lt;gazebo&gt;</span></code> tags to define materials for the links. For example, to apply a green color to a link named <em>example_link</em>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gazebo</span><span class="w"> </span><span class="na">reference=</span><span class="s">&quot;example_link&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;material&gt;</span>Gazebo/Green<span class="nt">&lt;/material&gt;</span>
<span class="nt">&lt;/gazebo&gt;</span>
</pre></div>
</div>
<section id="thymio-step-4">
<h3>Thymio - Step 4<a class="headerlink" href="#thymio-step-4" title="Link to this heading"></a></h3>
<div class="admonition-thymio admonition">
<p class="admonition-title">Thymio</p>
<p>Update the colors in <em>gazebo.xacro</em> to achieve the desired visual appearance in Gazebo.</p>
</div>
</section>
</section>
<section id="gazebo-plugins">
<h2>Gazebo Plugins<a class="headerlink" href="#gazebo-plugins" title="Link to this heading"></a></h2>
<p>Your Thymio is almost ready for simulation. The next step is to add control capabilities so the robot can move, and optionally, proximity sensors to detect obstacles. This chapter will guide you through these steps. Gazebo provides a range of plugins that simplify this process, as seen in the <a class="reference external" href="https://github.com/ros-simulation/gazebo_ros_pkgs/tree/ros2/gazebo_plugins/include/gazebo_plugins" rel="noopener noreferrer" target="_blank">gazebo_plugins</a> repository for ROS2.</p>
<p>To begin, let’s focus on control. The Thymio is a differential drive robot, so we need a plugin that functions as a differential drive controller. From the repository linked above, you can find the <code class="docutils literal notranslate"><span class="pre">gazebo_ros_diff_drive</span></code> plugin, which fulfills this role. The <a class="reference external" href="https://github.com/ros-simulation/gazebo_ros_pkgs/blob/ros2/gazebo_plugins/include/gazebo_plugins/gazebo_ros_diff_drive.hpp" rel="noopener noreferrer" target="_blank">gazebo_ros_diff_drive.hpp</a> file provides details on how to use this plugin effectively, which we will adapt for our application.</p>
<section id="thymio-step-5">
<h3>Thymio - Step 5<a class="headerlink" href="#thymio-step-5" title="Link to this heading"></a></h3>
<div class="admonition-thymio admonition">
<p class="admonition-title">Thymio</p>
<p>Open the <em>gazebo.xacro</em> file and paste the following code:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gazebo&gt;</span>
<span class="w">    </span><span class="nt">&lt;plugin</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;diff_drive_controller&quot;</span><span class="w"> </span><span class="na">filename=</span><span class="s">&quot;libgazebo_ros_diff_drive.so&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Update rate in Hz --&gt;</span>
<span class="w">    </span><span class="nt">&lt;update_rate&gt;</span>50<span class="nt">&lt;/update_rate&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- wheels --&gt;</span>
<span class="w">    </span><span class="nt">&lt;left_joint&gt;</span>???<span class="nt">&lt;/left_joint&gt;</span>
<span class="w">    </span><span class="nt">&lt;right_joint&gt;</span>???<span class="nt">&lt;/right_joint&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- kinematics --&gt;</span>
<span class="w">    </span><span class="nt">&lt;wheel_separation&gt;</span>???<span class="nt">&lt;/wheel_separation&gt;</span>
<span class="w">    </span><span class="nt">&lt;wheel_diameter&gt;</span>???<span class="nt">&lt;/wheel_diameter&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- input --&gt;</span>
<span class="w">    </span><span class="nt">&lt;command_topic&gt;</span>cmd_vel<span class="nt">&lt;/command_topic&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- output --&gt;</span>
<span class="w">    </span><span class="nt">&lt;publish_odom&gt;</span>true<span class="nt">&lt;/publish_odom&gt;</span>
<span class="w">    </span><span class="nt">&lt;publish_odom_tf&gt;</span>true<span class="nt">&lt;/publish_odom_tf&gt;</span>
<span class="w">    </span><span class="nt">&lt;publish_wheel_tf&gt;</span>true<span class="nt">&lt;/publish_wheel_tf&gt;</span>

<span class="w">    </span><span class="nt">&lt;odometry_topic&gt;</span>odom<span class="nt">&lt;/odometry_topic&gt;</span>
<span class="w">    </span><span class="nt">&lt;odometry_frame&gt;</span>odom<span class="nt">&lt;/odometry_frame&gt;</span>
<span class="w">    </span><span class="nt">&lt;robot_base_frame&gt;</span>???<span class="nt">&lt;/robot_base_frame&gt;</span>

<span class="w">    </span><span class="nt">&lt;/plugin&gt;</span>
<span class="nt">&lt;/gazebo&gt;</span>
</pre></div>
</div>
<p>This snippet includes the essential elements needed for the Thymio. Replace the <code class="docutils literal notranslate"><span class="pre">???</span></code> with the appropriate values. Accurately defining these parameters is critical for precise motion control.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">gazebo_ros_diff_drive</span></code> plugin takes velocity commands from the <code class="docutils literal notranslate"><span class="pre">cmd_vel</span></code> topic and rotates the wheels accordingly to achieve the desired motion. It also updates TFs and computes odometry for the robot.</p>
</div>
<p>Once the plugin configuration is complete, follow these steps to test it:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Launch the Gazebo simulation</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>thymio_description<span class="w"> </span>thymio.launch.xml
</pre></div>
</div>
</div></blockquote>
<p><div style="margin-top: 5px;"></div></p>
<blockquote>
<div><ol class="arabic simple" start="2">
<li><p>Send velocity commands from the terminal</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">topic</span> <span class="n">pub</span> <span class="o">/</span><span class="n">cmd_vel</span> <span class="n">geometry_msgs</span><span class="o">/</span><span class="n">msg</span><span class="o">/</span><span class="n">Twist</span> <span class="s2">&quot;{linear: </span><span class="si">{x: 0.2}</span><span class="s2">, angular: </span><span class="si">{z: 0.0}</span><span class="s2">}&quot;</span>
</pre></div>
</div>
<p>This command sends a <em>Twist</em> message, which controls the robot’s velocities. The <em>Twist</em> type allows control of three linear velocities and three angular velocities. For a differential drive robot like the Thymio, you can only adjust the linear speed in the x-direction and angular speed around the z-axis.</p>
</div></blockquote>
<p>Experiment with different commands and observe how the robot responds. Additionally, try removing the friction coefficients added to the caster wheel link to explore how this impacts the Thymio’s behavior in the simulation.</p>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>Despite addressing most motion-related issues, the robot may still behave unexpectedly when moving backward. Specifically, the Thymio tends to deviate and turn instead of maintaining a straight line. Forward and rotational movements are more stable, so it is recommended to prioritize these and avoid using backward motion whenever possible.</p>
</div>
<div class="admonition-break-time admonition">
<p class="admonition-title">Break Time</p>
<p>If this session felt intense, take a moment to relax and have some fun with your Thymio. You can control it using your keyboard by running the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>teleop_twist_keyboard<span class="w"> </span>teleop_twist_keyboard
</pre></div>
</div>
</div>
<p>So far, you have constructed a Thymio model capable of movement using Gazebo’s differential drive plugin. However, an essential feature is still missing: <strong>sensors</strong>.</p>
<p>Typically, adding sensors in a URDF involves the following steps:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Create and position sensor links</strong>: Each sensor requires a dedicated link in the URDF file, accurately placed to match the robot’s structure.</p></li>
<li><p><strong>Define sensor properties</strong>: Use <code class="docutils literal notranslate"><span class="pre">&lt;sensor&gt;</span></code> tags to specify parameters like type, range, and topic names.</p></li>
<li><p><strong>Integrate Gazebo plugins</strong>: Add plugins to enable the sensors to function in the simulation environment.</p></li>
</ul>
</div></blockquote>
<p>In our case, we want to add proximity sensors to the Thymio, enabling it to detect obstacles.</p>
</section>
<section id="thymio-step-6">
<h3>Thymio - Step 6<a class="headerlink" href="#thymio-step-6" title="Link to this heading"></a></h3>
<div class="admonition-thymio admonition">
<p class="admonition-title">Thymio</p>
<p>Adding multiple sensors manually can be a complex and time-consuming process. To simplify this, we provide a pre-configured file that facilitates the integration of proximity sensors into your Thymio model. Just follow the steps below:</p>
<ol class="arabic simple">
<li><p>Locate the provided configuration file</p></li>
</ol>
<p>The <em>proximity_sensors.xacro</em> file is already included in the <em>/urdf/thymio</em> directory of the downloaded package.</p>
<ol class="arabic simple" start="2">
<li><p>Include the file in your URDF</p></li>
</ol>
<p>Add the file to <em>thymio.urdf.xacro</em>, ensuring it is included after <em>thymio_chassis.xacro</em> as it references the <code class="docutils literal notranslate"><span class="pre">base_link</span></code>.</p>
<ol class="arabic simple" start="3">
<li><p>Adjust the <code class="docutils literal notranslate"><span class="pre">base_link</span></code> dimensions</p></li>
</ol>
<p>Update the <code class="docutils literal notranslate"><span class="pre">base_link</span></code> length to 0.091 (reduced from 0.11) to correctly position the proximity sensors at the front of the Thymio. This adjustment ensures the sensors are properly positioned outside the chassis while maintaining the robot’s real-world dimensions.</p>
</div>
<p>Now, you are ready to test the updated model. Build the package and launch the enhanced Thymio in Gazebo to observe the result.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>thymio_description<span class="w"> </span>thymio.launch.xml
</pre></div>
</div>
</section>
</section>
<section id="feedback-form">
<h2>Feedback Form<a class="headerlink" href="#feedback-form" title="Link to this heading"></a></h2>
<div class="admonition-help-us-improve admonition">
<p class="admonition-title">Help Us Improve</p>
<p>We would love to hear from you! Please complete <a class="reference external" href="https://forms.gle/Gg8a79tHdQ8FHdfX6" rel="noopener noreferrer" target="_blank">this form</a> to share your thoughts and help us improve. Your feedback is greatly appreciated!</p>
</div>
</section>
<section id="gazebo-worlds-optional">
<h2>Gazebo Worlds - Optional<a class="headerlink" href="#gazebo-worlds-optional" title="Link to this heading"></a></h2>
<p>To conclude today’s session, let’s add the final element needed to achieve a fully functional simulation in ROS2 with Gazebo. So far, we have been working in an empty environment, but to test local avoidance algorithms, it would be beneficial to introduce obstacles into the world. There are two main ways to customize your world:</p>
<ol class="arabic">
<li><p>Adding objects</p>
<blockquote>
<div><p>Open the <code class="docutils literal notranslate"><span class="pre">Insert</span></code> panel in Gazebo, where you can find libraries (e.g. <a class="reference external" href="http://models.gazebosim.org/" rel="noopener noreferrer" target="_blank">http://models.gazebosim.org/</a>) offering various objects to include in your world. When moving an object, hold down <code class="docutils literal notranslate"><span class="pre">Shift</span></code> to snap it to the grid for better alignment.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When launching Gazebo, it may take some time for the object libraries to load. Be patient, and the list of objects should appear shortly.</p>
</div>
</div></blockquote>
</li>
<li><p>Adding walls</p>
<blockquote>
<div><p>Navigate to <em>Edit &gt; Building Editor</em>, which opens a window where you can create custom rooms. The interface consists of two main parts:</p>
<ul class="simple">
<li><p><strong>Editing interface</strong> (squared sheet): This is where you design your room layout by selecting <em>Walls</em> and drawing directly on the grid. You can also add features such as doors and windows by placing them onto the walls.</p></li>
<li><p><strong>Preview area</strong>: This section provides a visualization of the room as you design it. You can add textures to the walls directly in this area.</p></li>
</ul>
<p><div style="margin-top: 5px;"></div></p>
<p>Once finished, save your work by going to <em>File &gt; Save</em>. Save the room at the default location with your chosen name. Exit the editor via <em>File &gt; Exit Building Editor</em>.</p>
<p>The room you created will now appear as a new object that you can place in your environment.</p>
</div></blockquote>
</li>
</ol>
<p>After finalizing your environment, ensure the Thymio robot is not part of the saved world. If it is, delete it to avoid having it treated as an object when the world is reopened. Save the world by going to <em>File &gt; Save World As</em> and save it as <em>gazebo_world.world</em> in the <em>/urdf/world</em> directory of the <em>thymio_description</em> package.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you open <em>gazebo_world.world</em>, you will notice that it is written in SDF (Simulation Description Format), which, like the URDF file, is an XML-based format. The SDF defines Gazebo’s simulation environment, specifying objects, lights, physics and environmental parameters.</p>
</div>
<p>To spawn the Thymio in your custom environment, you need to update the launch file. Modify <em>thymio.launch.xml</em> to ensure the Thymio spawns directly into your world. Replace <em>empty.world</em> with <em>gazebo_world.world</em> so that the path to your custom world is correctly specified.</p>
<p>After saving the changes, build the package and execute the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>thymio_description<span class="w"> </span>thymio.launch.xml
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="prep_work_2.html" class="btn btn-neutral float-left" title="Preparatory Work 2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="prep_work_3.html" class="btn btn-neutral float-right" title="Preparatory Work 3" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Luca Sidoti Pinto.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>