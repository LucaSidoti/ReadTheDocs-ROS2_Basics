

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Session 1 &mdash; ROS2 Basics  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=7ab3649f" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="_static/code-tabs.css?v=1bc26e2f" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=756e2391" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="_static/togglebutton.js?v=4a39c7ea"></script>
      <script src="_static/code-tabs.js?v=c983d12e"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Preparatory Work 2" href="prep_work_2.html" />
    <link rel="prev" title="Preparatory Work 1" href="prep_work_1.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            ROS2 Basics
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="prep_work_1.html">Preparatory Work 1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#why-ros2">Why ROS2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#selecting-a-ros2-distribution">Selecting a ROS2 Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#why-docker">Why Docker?</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#installing-docker-desktop">Installing Docker Desktop</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#exploring-tools">Exploring Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#learning-basic-linux-commands">Learning Basic Linux Commands</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Session 1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ros2-installation">ROS2 Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ros2-project-build">ROS2 Project Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="#first-node">First Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="#communication-overview">Communication Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#topics-overview">Topics Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercise-1">Exercise 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#services-overview">Services Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-interfaces">Custom Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prep_work_2.html">Preparatory Work 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prep_work_2.html#thymio-example">Thymio Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_2.html#exercise-2">Exercise 2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="session_2.html">Session 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="prep_work_3.html">Preparatory Work 3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prep_work_3.html#turtlesim-overview">Turtlesim Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_3.html#turtlesim-challenge">Turtlesim Challenge</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="session_3.html">Session 3</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ROS2 Basics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Session 1</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/session_1.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="session-1">
<h1>Session 1<a class="headerlink" href="#session-1" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>In this hands-on lab, we will dive into the exciting world of ROS2, exploring its project structure and core components. You will learn how to build a ROS2 project from scratch, focusing on key elements such as nodes, topics, publishers, subscribers, services, and interfaces.</p>
<p>Throughout this session, we will guide you step-by-step to ensure you understand how these components work together. You will also discover essential debugging tools that will help you troubleshoot and refine your projects.</p>
<p>Feel free to follow our guidelines closely and complete the tasks as they come up. Remember, if you ever feel stuck or have questions about any concepts, do not hesitate to reach out for help. We are here to support you on this journey!</p>
</section>
<section id="ros2-installation">
<h2>ROS2 Installation<a class="headerlink" href="#ros2-installation" title="Link to this heading"></a></h2>
<p>Up until now, we have mentioned that ROS2 is pre-installed in the Docker environment. Now it is time to confirm that it is actually there. To do this, we will use some demo packages that come with the ROS2 installation. Follow these steps to check it out:</p>
<ol class="arabic simple">
<li><p>Open <strong>Terminator</strong> and split the window into two terminals</p></li>
<li><p>In one of the terminals, run the following command:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>demo_nodes_cpp<span class="w"> </span>talker
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>In the second terminal, run this command:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>demo_nodes_py<span class="w"> </span>listener
</pre></div>
</div>
<p>What you should see is that the C++ node publishes a message to a topic, while the Python node listens to it.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not panic if that did not make much sense right now. We will cover these concepts during today’s session. No stress!</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You have successfully verified that ROS2 is installed and seen how programs in different languages (Python and C++) communicate through ROS2, showing its <strong>language-agnostic</strong> feature.</p>
<p>For the rest of the course, we will focus on <strong>Python</strong>.</p>
</div>
<p>However, that is not the only thing that has been pre-installed for your comfort. In fact, a few lines have also been added to a configuration file called <em>.bashrc</em>. This file is a script that executes every time you open a new terminal, in order to configure the terminal’s local environment. Let’s take a closer look:</p>
<ol class="arabic simple">
<li><p>Open the <em>.bashrc</em> file</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nano<span class="w"> </span>~/.bashrc
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Scroll to the bottom of the script using <code class="docutils literal notranslate"><span class="pre">▼</span></code>, here you should see the following lines:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>/opt/ros/humble/setup.bash
<span class="nb">source</span><span class="w"> </span>/usr/share/colcon_argcomplete/hook/colcon-argcomplete.bash
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Comment the <em>source /opt/ros/humble/setup.bash</em> and save the file</p></li>
<li><p>Close the previous terminals and open a <strong>new</strong> one</p></li>
<li><p>Run the same talker node as before</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>demo_nodes_cpp<span class="w"> </span>talker
</pre></div>
</div>
<p><strong>Question:</strong> What do you observe?</p>
<ol class="arabic simple" start="6">
<li><p>Now run the source command in the terminal and run the <em>talker</em> node again</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>/opt/ros/humble/setup.bash
ros2<span class="w"> </span>run<span class="w"> </span>demo_nodes_cpp<span class="w"> </span>talker
</pre></div>
</div>
<p><strong>Question:</strong> What do you conclude? What does the source command do?</p>
<p>Once you have understood the meaning of this command, go back to <em>.bashrc</em> file, uncomment the <em>source</em> command and save the file.</p>
<p><strong>Question:</strong> What is the benefit of having the <em>source</em> command in <em>.bashrc</em>?</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have been copying and pasting commands into the terminal, that is great! But remember the <em>tab completion tricks</em> we covered in the preparatory work. These also work with ROS2 commands. Give it a try by typing the following in your terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>de
</pre></div>
</div>
<p>Then, double-tap <code class="docutils literal notranslate"><span class="pre">tab</span></code>. You should see the available options. Now type <strong>m</strong> and press <code class="docutils literal notranslate"><span class="pre">tab</span></code> again. The command will autocomplete! Use these tricks to type faster.</p>
</div>
<p>Previously, we also mentioned a second line that was added to your convenience. We will see what does the <em>source /usr/share/colcon_argcomplete/hook/colcon-argcomplete.bash</em> command do later in the course when the time is right.</p>
</section>
<section id="ros2-project-build">
<h2>ROS2 Project Build<a class="headerlink" href="#ros2-project-build" title="Link to this heading"></a></h2>
<p>Now that you have verified ROS2 is installed on your desktop, let’s create a ROS2 project! The first step is to set up a workspace, which is essentially a directory where you will store your project. Within this directory, you will need to create a source folder where your application development will take place. Your workspace will also contain other folders, which we will explore later.</p>
<p>Let’s create the workspace and its source folder in your home directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~
mkdir<span class="w"> </span>-p<span class="w"> </span>ros2_basics_ws/src
</pre></div>
</div>
<p>Next, verify that the directory was created successfully and that it contains the source folder.</p>
<p>As mentioned earlier, all your applications will be developed inside the source folder. Within this folder, you will add packages related to your project. Packages are the fundamental building blocks in ROS2 that help structure your project. They organize and group related functionalities and are designed to be modular and reusable, allowing you to use them in other projects.</p>
<p>Packages can contain a variety of elements, including nodes, libraries, configuration files, launch files, interfaces, documentation, and more. While this might seem overwhelming at first, we will clarify these concepts during the session. Let’s dive in and create our first Python package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ros2_basics_ws/src/
ros2<span class="w"> </span>pkg<span class="w"> </span>create<span class="w"> </span>ros2_basics_pkg<span class="w"> </span>--build-type<span class="w"> </span>ament_python
</pre></div>
</div>
<p>You can now open the source folder in VSCode and take a look at what was generated when you created the package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>code<span class="w"> </span>.
</pre></div>
</div>
<p>Let’s go over the essential files you will need to pay attention to as you start working with ROS2:</p>
<ol class="arabic simple">
<li><p><em>setup.py</em>: This file is where you will declare your executable ROS2 programs</p></li>
<li><p><em>package.xml</em>: This file defines the dependencies for your package</p></li>
<li><p><em>ros2_basics_pkg</em>: This folder will contain your package’s code and resources</p></li>
</ol>
<p>Again, these concepts will become much clearer when we will create our first program.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Our work environment already includes all necessary dependencies. To avoid adding unnecessary complexities, we will not modify the <em>package.xml</em> file in this class. However, remember that this file is crucial for publishing your package, as it lists the dependencies needed for others to use it effectively.</p>
</div>
<p>The final topic for this section is how to build a project. ROS2 provides a build tool called <em>colcon</em>, which is used to compile packages within a ROS2 workspace. It manages dependencies and ensures everything is properly linked. Let’s go ahead and build your first project:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ros2_basics_ws/
colcon<span class="w"> </span>build
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure you are in the <strong>workspace</strong> directory before running the build command!</p>
</div>
<p>Once the build is complete, list the contents of your workspace. If the build worked successfully, you should see four folders: <em>/src</em>, <em>/build</em>, <em>/log</em>, and <em>/install</em>. You have already created the source folder yourself, but the other three are generated during the build process:</p>
<ul class="simple">
<li><p><em>/log</em>: Contains the logs of the compilation process</p></li>
<li><p><em>/build</em>: Stores intermediate files, tests, and temporary data</p></li>
<li><p><em>/install</em>: This is the most important folder, as it holds the compiled files necessary for execution</p></li>
</ul>
<p>There are also additional useful commands to build your project:</p>
<ol class="arabic">
<li><p>To build a specific package from your workspace:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>colcon<span class="w"> </span>build<span class="w"> </span>--packages-select<span class="w"> </span>&lt;pkg_name&gt;
</pre></div>
</div>
</li>
<li><p>To create symbolic links to your files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>colcon<span class="w"> </span>build<span class="w"> </span>--symlink-install
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>This requires a bit more explanation. Normally, when you run <em>colcon build</em>, it takes all your files from <em>/src</em>, build them into <em>/build</em>, and install them into <em>/install</em>. ROS2 only recognizes the files in the <em>/install</em> directory, so any changes you make in <em>/src</em> will not be applied until you rebuild the project.</p>
<p>However, using the <em>colcon build –symlink-install</em> command creates symbolic links to the files in the <em>/src</em> folder. This allows ROS2 to track changes in your files automatically, so you do not have to rebuild the project each time.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>While this command is convenient, we recommend not using it initially so you can get familiar with the building process.</p>
</div>
</div></blockquote>
<p>At this point, we can also explain the second line that was added to your <em>.bashrc</em> file. The <em>source /usr/share/colcon_argcomplete/hook/colcon-argcomplete.bash</em> command enables <em>tab completion</em> for <em>colcon</em> commands. Try it yourself! Comment or uncomment this line in your <em>.bashrc</em> file, then try typing a <em>colcon</em> command in you terminal with the <code class="docutils literal notranslate"><span class="pre">tab</span></code> key to see the difference.</p>
</section>
<section id="first-node">
<h2>First Node<a class="headerlink" href="#first-node" title="Link to this heading"></a></h2>
<p>It is finally time to start working with your first ROS2 program! In this chapter you will create your first node. A node is an independent program that handles a specific task in a ROS2 system. It is the main brick of the ROS2 environment. In a concrete project you will have multiple nodes that can communicate through topics or services (let’s keep this for later) in order to achieve the desired tasks. Enough talking, let’s go to work:</p>
<ol class="arabic simple">
<li><p>Move into the development package that we created before</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ros2_basics_ws/src/ros2_basics_pkg/ros2_basics_pkg
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Create a empty file</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>touch<span class="w"> </span>minimal_node.py
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Make it executable</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>+x<span class="w"> </span>minimal_node.py
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Add the following content inside your file</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="k">class</span> <span class="nc">MinimalNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;node_name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Minimal Node has been started&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">minimal_node</span> <span class="o">=</span> <span class="n">MinimalNode</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">minimal_node</span><span class="p">)</span>
    <span class="n">minimal_node</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<blockquote>
<div><p>Let’s break down the key components of this minimal ROS2 node:</p>
<ol class="loweralpha simple">
<li><p><strong>Imports</strong></p></li>
</ol>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rclpy</span></code>: ROS2 core Python library</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Node</span></code>: Base class to define a ROS2 node</p></li>
</ul>
<ol class="loweralpha simple" start="2">
<li><p><strong>Class Definition</strong></p></li>
</ol>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MinimalNode</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">Node</span></code>, enabling access to ROS2 functionalities</p></li>
<li><p>Written in Object-Oriented Programming (OOP) style</p></li>
</ul>
<ol class="loweralpha simple" start="3">
<li><p><strong>Constructor (__init__)</strong></p></li>
</ol>
<ul class="simple">
<li><p>Initializes the node with <code class="docutils literal notranslate"><span class="pre">super().__init__(&quot;node_name&quot;)</span></code>, ensures that the node is correctly registered in the ROS2 system, and assigns it a name</p></li>
<li><p>Logs a message when the node starts</p></li>
</ul>
<ol class="loweralpha simple" start="4">
<li><p><strong>Main Function</strong></p></li>
</ol>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rclpy.init()</span></code>: Starts ROS2 communication</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rclpy.spin(minimal_node)</span></code>: You will find out for yourself soon!</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">destroy_node()</span></code> and <code class="docutils literal notranslate"><span class="pre">rclpy.shutdown()</span></code>: Once the node is no longer required, it is properly destroyed and ROS2 communications are interrupted</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>As mentionned in the previous section, we also need to declare the file as a ROS2 executable program in <em>setup.py</em>.</p></li>
</ol>
<blockquote>
<div><p>This is done by adding an entry point as follow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;first_node = ros2_basics_pkg.minimal_node:main&quot;</span>
    <span class="p">],</span>
<span class="p">},</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The general structure for the entrypoints is as follow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;&lt;executable_name_1&gt; = &lt;pkg_name&gt;.&lt;file_name_1&gt;:main&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&lt;executable_name_2&gt; = &lt;pkg_name&gt;.&lt;file_name_2&gt;:main&quot;</span>
    <span class="p">],</span>
<span class="p">},</span>
</pre></div>
</div>
<p>Be sure to understand the difference between <em>executable_name</em>,  <em>file_name</em> and  <em>node_name</em>. When you will run a program from your terminal you will use the <em>executable_name</em> so be sure to know which one it is. Moreover, we would like to point out the <code class="docutils literal notranslate"><span class="pre">,</span></code> between the lines of the <em>entry_points</em> when your package contains multiple programs.</p>
</div>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Build the project and run the node</p></li>
</ol>
<p>Now you are finally ready to build and run your first node!</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Open a terminal, navigate to the workspace and build your project</p></li>
<li><p>Try to run the node with the following command:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>ros2_basics_pkg<span class="w"> </span>first_node
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The general structure to run a ROS2 node is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>&lt;pkg_name&gt;<span class="w"> </span>&lt;executable_name&gt;
</pre></div>
</div>
</div>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>At this point, you might encounter an unexpected message in your terminal. Can you guess what could be the problem? Ask for help and discuss with your assistant of the potential issue and how to solve it!</p>
</div>
<blockquote>
<div><ol class="loweralpha simple" start="3">
<li><p>After having successfully run the node, you can kill it with <code class="docutils literal notranslate"><span class="pre">Ctrl+C</span></code></p></li>
</ol>
</div></blockquote>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Comment the spin function</p></li>
</ol>
<p>Go back to <em>minimal_node.py</em> and comment <code class="docutils literal notranslate"><span class="pre">rclpy.spin(minimal_node)</span></code>. Save the changes, build the project and run the program again.</p>
<p><strong>Question:</strong> What difference do you observe?</p>
</section>
<section id="communication-overview">
<h2>Communication Overview<a class="headerlink" href="#communication-overview" title="Link to this heading"></a></h2>
<p>Previously, you were introduced to the main building block of a ROS2 system: the node. In any real robotic application, you will not be working with just one node. Instead, you will typically have multiple nodes, each handling a specific task. These nodes operate independently, which means they need a way to communicate with each other to work together effectively.</p>
<p>ROS2 provides exactly what we need for this by offering a <em>message-passing</em> mechanism that allows nodes to exchange information without needing direct connections. This way, each node can stay focused on its own job, while still being part of a larger system. Importantly, this communication happens within the same network, allowing nodes on different devices or computers to interact as long as they are connected to the same network.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="_images/communication.gif"><img alt="_images/communication.gif" src="_images/communication.gif" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Nodes/Understanding-ROS2-Nodes.html" rel="noopener noreferrer" target="_blank">Communication between Nodes</a></span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>To keep things organized, ROS2 uses two main communication methods:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Topics</strong>: Used for continuous data exchange, allowing nodes to publish information that others can subscribe to.</p></li>
<li><p><strong>Services</strong>: Used for request-response interactions, letting nodes request specific actions from each other and receive replies.</p></li>
</ul>
</div></blockquote>
<p>This communication setup helps keep the system modular and scalable, making it easier to design complex robotic systems. Now, let’s dive into the details and see how these mechanisms work in practice!</p>
</section>
<section id="topics-overview">
<h2>Topics Overview<a class="headerlink" href="#topics-overview" title="Link to this heading"></a></h2>
<p>Let’s move forward in our journey and add communication in this project. Let’s start by taking a closer look at the talker-listener example:</p>
<ol class="arabic simple">
<li><p>Open <strong>Terminator</strong> and split the window into three terminals</p></li>
<li><p>In one of the terminals, run the following command:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>demo_nodes_cpp<span class="w"> </span>talker
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>In another one, run this command:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>demo_nodes_py<span class="w"> </span>listener
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>In the last terminal, run simply:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rqt_graph
</pre></div>
</div>
<p>As you can see, <strong>rqt_graph</strong> is a powerful tool in the ROS2 ecosystem that allows you to visualize the interactions between nodes. In our example, you can see that the <em>talker</em> node publishes messages to the <em>chatter</em> topic. Meanwhile, the <em>listener</em> node subscribes to this topic, enabling it to receive those messages.</p>
<p>Now that you have had a taste of what communication can look like in ROS2, let’s delve a little into the theory behind it.</p>
<p>In the simple <strong>talker-listener</strong> communication example, you saw the interaction between two key components: <strong>nodes</strong> and a <strong>topic</strong>.</p>
<ul class="simple">
<li><p>A <strong>topic</strong> is a communication channel used by nodes to exchange messages.</p></li>
<li><p>A node acting as a <strong>publisher</strong> can send data to a topic.</p></li>
<li><p>A node acting as a <strong>subscriber</strong> can receive data from a topic.</p></li>
</ul>
<p>The data exchanged through a topic is called a <strong>message</strong>, which follows a defined <strong>data structure</strong>.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="_images/topics.gif"><img alt="_images/topics.gif" src="_images/topics.gif" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Topics/Understanding-ROS2-Topics.html" rel="noopener noreferrer" target="_blank">Communication via Topics</a></span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition-key-aspects admonition">
<p class="admonition-title">Key aspects</p>
<ul class="simple">
<li><p>A <strong>topic</strong> is defined by a <strong>name</strong> and a <strong>message type</strong>.</p></li>
<li><p>Topics are used for continuous, unidirectional communication.</p></li>
<li><p>A topic can have <strong>multiple publishers and subscribers</strong>.</p></li>
<li><p>ROS2 communication is <strong>anonymous</strong>: publishers and subscribers exchange data via topics without knowing the existence of each other.</p></li>
</ul>
</div>
<p>Now that you have a better understanding of how topic communication works in ROS2, let’s create our own publishers and subscribers:</p>
<ol class="arabic simple">
<li><p>Create two new Python files in the <em>ros2_basics_pkg</em> folder: <em>publisher.py</em> and <em>subscriber.py</em></p></li>
<li><p>Make both files executable</p></li>
<li><p>Add the following code for the publisher</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>

<span class="k">class</span> <span class="nc">MinimalPublisher</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;minimal_publisher&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s1">&#39;topic&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">timer_period</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span><span class="n">timer_period</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">timer_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;Hello World: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Publishing: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">minimal_publisher</span> <span class="o">=</span> <span class="n">MinimalPublisher</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">minimal_publisher</span><span class="p">)</span>
    <span class="n">minimal_publisher</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Question:</strong> What are the essential elements of a publisher?</p>
<ol class="arabic simple" start="4">
<li><p>Run the publisher node</p></li>
</ol>
<p>Update the <em>setup.py</em> file, then build the project and run the node. If you have any questions about these steps, please refer to the previous section or ask for assistance.</p>
<ol class="arabic simple" start="5">
<li><p>Examine the system</p></li>
</ol>
<p>Open a new terminal and explore various ROS2 Command Line Interface (CLI) tools to inspect the system. Additionally, use <code class="docutils literal notranslate"><span class="pre">rqt_graph</span></code>  to visualize what is happening.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>CLI</p></th>
<th class="head"><p>Command</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>List all nodes</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">node</span> <span class="pre">list</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Get details on a node</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">node</span> <span class="pre">info</span> <span class="pre">&lt;node_name&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>List all topics</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">topic</span> <span class="pre">list</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>List all topics + message type</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">topic</span> <span class="pre">list</span> <span class="pre">-t</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Display messages published to a topic</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">topic</span> <span class="pre">echo</span> <span class="pre">&lt;topic_name&gt;</span></code></p></td>
</tr>
</tbody>
</table>
<p>After inspection, kill the node by pressing <code class="docutils literal notranslate"><span class="pre">Ctrl+C</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These tools are essential for debugging your system, allowing you to check node status, view active topics, and analyze message flow. They also help identify message types and understand node interactions, making it easier to spot issues and ensure your ROS2 applications run smoothly.</p>
</div>
<p>We have finished with the publisher node for now, let’s move on to the subscriber node:</p>
<ol class="arabic simple" start="6">
<li><p>Add the following code for the subscriber</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>

<span class="k">class</span> <span class="nc">MinimalSubscriber</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;minimal_subscriber&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">String</span><span class="p">,</span><span class="s1">&#39;topic&#39;</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">listener_callback</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscription</span>  <span class="c1"># prevent unused variable warning</span>

    <span class="k">def</span> <span class="nf">listener_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;I heard: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">minimal_subscriber</span> <span class="o">=</span> <span class="n">MinimalSubscriber</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">minimal_subscriber</span><span class="p">)</span>
    <span class="n">minimal_subscriber</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Question:</strong> What are the essential elements of a subscriber?</p>
<ol class="arabic simple" start="7">
<li><p>Run the publisher node</p></li>
</ol>
<p>Update the <em>setup.py</em> file, then build the project and run the node.</p>
<ol class="arabic simple" start="8">
<li><p>Examine the system</p></li>
</ol>
<p>Open a new terminal and explore various ROS2 Command Line Interface (CLI) tools to inspect the system. Additionally, use <code class="docutils literal notranslate"><span class="pre">rqt_graph</span></code>  to visualize what is happening.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>CLI</p></th>
<th class="head"><p>Command</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>List all nodes</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">node</span> <span class="pre">list</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Get details on a node</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">node</span> <span class="pre">info</span> <span class="pre">&lt;node_name&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>List all topics</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">topic</span> <span class="pre">list</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>List all topics + message type</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">topic</span> <span class="pre">list</span> <span class="pre">-t</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Publish a message to a topic</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">topic</span> <span class="pre">pub</span> <span class="pre">&lt;topic_name&gt;</span> <span class="pre">&lt;msg_type&gt;</span> <span class="pre">&quot;{msg_field:</span> <span class="pre">'msg'}&quot;</span></code></p></td>
</tr>
</tbody>
</table>
<p>After inspection, kill the node by pressing <code class="docutils literal notranslate"><span class="pre">Ctrl+C</span></code>.</p>
<ol class="arabic simple" start="9">
<li><p>Run the publisher and subscriber simultaneously</p></li>
</ol>
<p>At this stage, you can run both the <em>publisher</em> and <em>subscriber</em> at the same time. Utilize the commands introduced earlier to inspect the nodes and topics. Additionally, use <code class="docutils literal notranslate"><span class="pre">rqt_graph</span></code> to visualize the communication.</p>
<ol class="arabic simple" start="10">
<li><p>Manage multiple publishers</p></li>
</ol>
<p>Keep the <em>publisher</em> and <em>subscriber</em> running, then launch a <strong>second publisher</strong> using the usual command.</p>
<p><strong>Question:</strong> What happens when we run two publishers with the same node name?</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">node</span> <span class="pre">list</span></code> or <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">node</span> <span class="pre">info</span></code> to help you answer this question.</p>
</div>
<p>In some scenarios, it may be useful to run the same executable with different node names. ROS2 allows this through a feature called <strong>remapping</strong>. Here is the syntax for the run command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>&lt;pkg_name&gt;<span class="w"> </span>&lt;executable_name&gt;<span class="w"> </span>--ros-args<span class="w"> </span>-r<span class="w"> </span>__node:<span class="o">=</span>new_node_name
</pre></div>
</div>
<div class="admonition-task admonition">
<p class="admonition-title">Task</p>
<p>Launch two publishers and two subscribers, each with unique names. Verify that you get the expected results using the CLI commands and <code class="docutils literal notranslate"><span class="pre">rqt_graph</span></code>.</p>
</div>
<ol class="arabic simple" start="11">
<li><p>Remap topic at runtime</p></li>
</ol>
<p>Just like nodes, topics can be renamed at runtime using remapping. You can achieve this with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>&lt;pkg_name&gt;<span class="w"> </span>&lt;executable_name&gt;<span class="w"> </span>--ros-args<span class="w"> </span>-r<span class="w"> </span>default_topic_name:<span class="o">=</span>new_topic_name
</pre></div>
</div>
<div class="admonition-task admonition">
<p class="admonition-title">Task</p>
<p>Experiment with different publishers and subscribers by using remapping to create a graph similar to the one shown below.</p>
<a class="reference internal image-reference" href="_images/task2.png"><img alt="_images/task2.png" class="align-center" src="_images/task2.png" style="width: 80%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<p>Note: In the rqt_graph interface, ensure you select <code class="docutils literal notranslate"><span class="pre">Nodes/Topics</span> <span class="pre">(all)</span></code> rather than <code class="docutils literal notranslate"><span class="pre">Nodes</span> <span class="pre">only</span></code> to obtain the same graph representation.</p>
</div>
</section>
<section id="exercise-1">
<h2>Exercise 1<a class="headerlink" href="#exercise-1" title="Link to this heading"></a></h2>
<p>Now it is time to put your skills to the test! Apply what you have learned so far to complete the following exercise.</p>
<section id="heat-index-monitoring-system">
<h3>Heat Index Monitoring System<a class="headerlink" href="#heat-index-monitoring-system" title="Link to this heading"></a></h3>
<p>Create a ROS2 system where two different sensors (simulated as publishers) publish temperature and humidity data to separate topics. A third node (subscriber) listens to both topics, combines the data, and logs an alert if the <em>heat index</em> (a combination of temperature and humidity) exceeds a certain threshold.</p>
<p><strong>Steps</strong></p>
<ol class="arabic simple">
<li><p>Create two publishers</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>One publisher will simulate a <strong>temperature sensor</strong> and publish random temperature values in <strong>Celsius</strong> (between 27°C and 43°C) on the <em>temperature</em> topic</p></li>
<li><p>The second publisher will simulate a <strong>humidity sensor</strong> and publish random humidity values (between 40% and 100%) on the <em>humidity</em> topic</p></li>
<li><p>These values should be published at regular intervals (every 5 seconds)</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Create a subscriber</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>This node subscribes to both <em>temperature</em> and <em>humidity</em> topics</p></li>
<li><p>It calculates the heat index using the following formula:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">heat_index</span> <span class="o">=</span> <span class="o">-</span><span class="mf">42.379</span> <span class="o">+</span> <span class="mf">2.04901523</span> <span class="o">*</span> <span class="n">T</span> <span class="o">+</span> <span class="mf">10.14333127</span> <span class="o">*</span> <span class="n">H</span> <span class="o">-</span> <span class="mf">0.22475541</span> <span class="o">*</span> <span class="n">T</span> <span class="o">*</span> <span class="n">H</span> \
             <span class="o">-</span> <span class="mf">6.83783e-3</span> <span class="o">*</span> <span class="n">T</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">5.481717e-2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">**</span> <span class="mi">2</span> \
             <span class="o">+</span> <span class="mf">1.22874e-3</span> <span class="o">*</span> <span class="n">T</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="mf">8.5282e-4</span> <span class="o">*</span> <span class="n">T</span> <span class="o">*</span> <span class="n">H</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">1.99e-6</span> <span class="o">*</span> <span class="n">T</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
</div></blockquote>
<blockquote>
<div><blockquote>
<div><p>where T is the temperature in <strong>Fahrenheit</strong> and H is the humidity as a percentage</p>
</div></blockquote>
<ul class="simple">
<li><p>It logs a warning if the heat index exceeds a threshold (125°F)</p></li>
</ul>
</div></blockquote>
<div class="admonition-hints admonition">
<p class="admonition-title">Hints</p>
<div class="toggle docutils container">
<ul class="simple">
<li><p>Consider developing your nodes in a new package (optional)</p></li>
<li><p>Use the <em>numpy.random</em> library to generate random integers. To avoid potential type-related errors, it is recommended to cast the result to an <em>int</em>:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy.random</span> <span class="k">as</span> <span class="nn">np_random</span>

<span class="n">random_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np_random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Utilize the <strong>UInt8</strong> from <em>std_msgs</em> as the message type for your topics</p></li>
<li><p>The final result should look like this in <em>rqt_graph</em>:</p></li>
</ul>
<a class="reference internal image-reference" href="_images/exercise1.png"><img alt="_images/exercise1.png" class="align-center" src="_images/exercise1.png" style="width: 80%;" />
</a>
</div>
</div>
</section>
</section>
<section id="services-overview">
<h2>Services Overview<a class="headerlink" href="#services-overview" title="Link to this heading"></a></h2>
<p>Topics are a fundamental communication tool, but they are not the only option available. ROS2 also provides us with <strong>services</strong>, which offer a different way to handle communication between nodes. Let’s dive into this concept with an example:</p>
<ol class="arabic simple">
<li><p>Run the <em>add_two_ints_server</em> from the <em>demo_nodes_py</em> package</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">run</span> <span class="n">demo_nodes_py</span> <span class="n">add_two_ints_server</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Inspect the system with CLI commands</p></li>
</ol>
<p>Use the following commands to see what is running, pay special attention to <em>/add_two_ints</em>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>CLI</p></th>
<th class="head"><p>Command</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>List all nodes</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">node</span> <span class="pre">list</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Get details on a node</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">node</span> <span class="pre">info</span> <span class="pre">&lt;node_name&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>List all services</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">service</span> <span class="pre">list</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>List all services + service type</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">service</span> <span class="pre">list</span> <span class="pre">-t</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Get details on a service type</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">interface</span> <span class="pre">show</span> <span class="pre">&lt;srv_type&gt;</span></code></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We cannot visualize services with <em>rqt_graph</em>.</p>
</div>
<ol class="arabic simple" start="3">
<li><p>Call the service from the terminal</p></li>
</ol>
<p>In our example, we can execute the last command listed in the above table as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>interface<span class="w"> </span>show<span class="w"> </span>example_interfaces/srv/AddTwoInts
</pre></div>
</div>
<p>In the terminal, you should see the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">int64</span> <span class="n">a</span>
<span class="n">int64</span> <span class="n">b</span>
<span class="o">---</span>
<span class="n">int64</span> <span class="nb">sum</span>
</pre></div>
</div>
<p>As the name suggests, the <em>add_two_ints_server</em> node is a server that takes two integers (<code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>) as input and returns their sum (<code class="docutils literal notranslate"><span class="pre">sum</span></code>). We can call this service with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">service</span> <span class="n">call</span> <span class="o">/</span><span class="n">add_two_ints</span> <span class="n">example_interfaces</span><span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">AddTwoInts</span> <span class="s2">&quot;{&#39;a&#39;: 2, &#39;b&#39;: 5}&quot;</span>
</pre></div>
</div>
<p>If you observe the terminal, you will see that the server has processed the incoming request and returned a response with the sum (<code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">+</span> <span class="pre">5</span> <span class="pre">=</span> <span class="pre">7</span></code>). In this example, we acted as a client to the service by sending a request and receiving a response from the server.</p>
<p>Feeling lost? That is okay! We are here to guide you through the theory behind services in just a moment.</p>
<p>In the simple <strong>add_two_ints</strong> example, you saw the interaction between two key components: <strong>nodes</strong> and a <strong>service</strong>.</p>
<ul class="simple">
<li><p>A <strong>service</strong> is request-response communication between nodes (client-server interaction).</p></li>
<li><p>A node acting as a <strong>server</strong> receives a request from a service, processes it and sends back a response.</p></li>
<li><p>A node acting as a <strong>client</strong> send a request to a service and gets an answer back.</p></li>
</ul>
<p>The data exchanged through a service is structured into two parts: a <strong>request</strong> and a <strong>response</strong>, each with its own specific <strong>data structure</strong>.</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="_images/services.gif"><img alt="_images/services.gif" src="_images/services.gif" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Services/Understanding-ROS2-Services.html" rel="noopener noreferrer" target="_blank">Communication via Services</a></span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition-key-aspects admonition">
<p class="admonition-title">Key aspects</p>
<ul class="simple">
<li><p><strong>One server per service</strong>, but <strong>multiple clients</strong> can interact with it</p></li>
<li><p>Two message types: <strong>request</strong> and <strong>response</strong></p></li>
<li><p><strong>Not intended for continuous communication</strong></p></li>
<li><p>Typically handles two kinds of requests: <strong>computation requests</strong> and <strong>settings changes</strong></p></li>
</ul>
</div>
<p>With this foundation, let’s move on to creating our own servers and clients in ROS2:</p>
<ol class="arabic simple">
<li><p>Create two new Python files in <em>ros2_basics_pkg</em>: <em>server.py</em> and <em>client.py</em></p></li>
<li><p>Make both files executable</p></li>
<li><p>Add the following code for the server</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="kn">from</span> <span class="nn">example_interfaces.srv</span> <span class="kn">import</span> <span class="n">AddTwoInts</span>

<span class="k">class</span> <span class="nc">MinimalServer</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;minimal_server&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_service</span><span class="p">(</span><span class="n">AddTwoInts</span><span class="p">,</span> <span class="s1">&#39;add_two_ints&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_two_ints_callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_two_ints_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">response</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Incoming request</span><span class="se">\n</span><span class="s1">a: </span><span class="si">%d</span><span class="s1"> b: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">b</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">response</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
    <span class="n">minimal_server</span> <span class="o">=</span> <span class="n">MinimalServer</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">minimal_server</span><span class="p">)</span>
    <span class="n">minimal_server</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Question:</strong> What are the essential elements of a server?</p>
<ol class="arabic simple" start="4">
<li><p>Add the following code for the client</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">example_interfaces.srv</span> <span class="kn">import</span> <span class="n">AddTwoInts</span>


<span class="k">class</span> <span class="nc">MinimalClient</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;minimal_client&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_add_two_ints_server</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">call_add_two_ints_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">AddTwoInts</span><span class="p">,</span> <span class="s2">&quot;add_two_ints&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="mf">1.0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Waiting for Server Add Two Ints...&quot;</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="n">AddTwoInts</span><span class="o">.</span><span class="n">Request</span><span class="p">()</span>
        <span class="n">request</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">request</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>

        <span class="n">future</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_call_add_two_ints</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">callback_call_add_two_ints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">future</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; + &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">sum</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Service call failed </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,))</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">minimal_client</span> <span class="o">=</span> <span class="n">MinimalClient</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">minimal_client</span><span class="p">)</span>
    <span class="n">minimal_client</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>As you can see, this program introduces more complexity compared to previous examples.  Let’s break it down step by step:</p>
<ul class="simple">
<li><p><strong>Overall Structure</strong></p>
<ul>
<li><p>The overall structure is similar to the minimal node, but includes additional functionalities to support client-server communication.</p></li>
</ul>
</li>
<li><p><strong>Calling the Service</strong></p>
<ul>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">self.call_add_two_ints_server(x,</span> <span class="pre">y)</span></code> is responsible for calling the server. In this example, it is called in the constructor, but in general it can be used anywhere else in the class as needed.</p></li>
</ul>
</li>
<li><p><strong>Creating the Client</strong></p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">call_add_two_ints_server(self,</span> <span class="pre">a,</span> <span class="pre">b)</span></code> method creates a client for the <code class="docutils literal notranslate"><span class="pre">add_two_ints</span></code> service.</p></li>
<li><p>The method sets up a request by assigning values to <code class="docutils literal notranslate"><span class="pre">request.a</span></code> and <code class="docutils literal notranslate"><span class="pre">request.b</span></code>.</p></li>
<li><p>The service call is made asynchronously with <code class="docutils literal notranslate"><span class="pre">client.call_async(request)</span></code>. This returns a <strong>future</strong> object, which will eventually hold the result once the server responds.</p></li>
<li><p>While waiting for the server response, a callback function is registered using <code class="docutils literal notranslate"><span class="pre">future.add_done_callback</span></code>. The <code class="docutils literal notranslate"><span class="pre">partial</span></code> function from the <code class="docutils literal notranslate"><span class="pre">functools</span></code> module is used here to pass additional arguments (<code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>) to the callback, ensuring that the response is linked to the original request.</p></li>
</ul>
</li>
<li><p><strong>Handling the Response</strong></p>
<ul>
<li><p>Once the server responds, the method <code class="docutils literal notranslate"><span class="pre">callback_call_add_two_ints(self,</span> <span class="pre">future,</span> <span class="pre">a,</span> <span class="pre">b)</span></code> is executed.</p></li>
<li><p>The result is accessed using <code class="docutils literal notranslate"><span class="pre">future.result()</span></code>, and this value can then be processed.</p></li>
</ul>
</li>
</ul>
<p>This structure allows the client to make non-blocking service calls and process the server’s response asynchronously. The use of <code class="docutils literal notranslate"><span class="pre">functools.partial</span></code> is crucial for tracking which request generated which response.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keep in mind that a synchronous version of service calls is available in ROS2. However, we are using the asynchronous approach here, which is generally recommended by the ROS community (<a class="reference external" href="https://docs.ros.org/en/humble/How-To-Guides/Sync-Vs-Async.html" rel="noopener noreferrer" target="_blank">Synchronous vs. asynchronous service clients</a>).</p>
</div>
<ol class="arabic simple" start="5">
<li><p>Build the project</p></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Have you updated <em>setup.py</em>?</p>
</div>
<ol class="arabic simple" start="6">
<li><p>Run both the server and client we have just created</p></li>
</ol>
<p>We have just rewritten the <em>add_two_ints</em> example in our own package, so the result should be identical. You can use CLI commands to verify this. Additionally, we have added a client node, allowing you to call the server directly from the program instead of using the <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">service</span> <span class="pre">call</span></code> command from the terminal.</p>
<p><strong>Question:</strong> What happends if the client node starts before the server? Why?</p>
</section>
<section id="custom-interfaces">
<h2>Custom Interfaces<a class="headerlink" href="#custom-interfaces" title="Link to this heading"></a></h2>
<p>By now, you should understand that <em>topics</em> and <em>services</em> are the core communication tools in ROS2. Both are defined by a <strong>name</strong> and a <strong>type</strong> (either msg or srv). The actual content being exchanged is referred to as an <strong>interface</strong>, representing the data structure of the information (message or service definition). In this final theoretical section, you will learn how to create custom data structures for messages and services, allowing you to define your own interfaces.</p>
<p>The first step is to create a package to store your custom interfaces. This is considered best practice because it keeps all your message and service definitions in one place, helping to avoid dependency issues. It is also important to note that custom interfaces in ROS2 must currently be defined in a C++ package. Let’s walk through how to do this in practice:</p>
<ol class="arabic simple">
<li><p>Create a new package</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ros2_basics_ws/src
ros2<span class="w"> </span>pkg<span class="w"> </span>create<span class="w"> </span>ros2_basics_interfaces<span class="w"> </span>--build-type<span class="w"> </span>ament_cmake
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Remove unnecessary folders</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>ros2_basics_interfaces
rm<span class="w"> </span>-rf<span class="w"> </span>include/
rm<span class="w"> </span>-rf<span class="w"> </span>src/
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Create new directories</p></li>
</ol>
<p>Next, we will create the <em>msg/</em> and <em>srv/</em> folders to store our custom message and service definitions:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>msg
mkdir<span class="w"> </span>srv
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Modify <em>package.xml</em> and <em>CmakeLists.txt</em></p></li>
</ol>
<p>Similar to Python packages, C++ packages also have a <em>package.xml</em> file. Additionally, there is a <em>CMakeLists.txt</em> file, which serves as the C++ equivalent of Python’s <em>setup.py</em>. To properly configure the package for custom interfaces, you need to add the following lines:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>In <em>package.xml</em></p></li>
</ol>
<p>Below <code class="docutils literal notranslate"><span class="pre">&lt;test_depend&gt;ament_lint_common&lt;/test_depend&gt;</span></code>, add:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;build_depend&gt;</span>rosidl_default_generators<span class="nt">&lt;/build_depend&gt;</span>
<span class="nt">&lt;exec_depend&gt;</span>rosidl_default_runtime<span class="nt">&lt;/exec_depend&gt;</span>
<span class="nt">&lt;member_of_group&gt;</span>rosidl_interface_packages<span class="nt">&lt;/member_of_group&gt;</span>
</pre></div>
</div>
<ol class="loweralpha simple" start="2">
<li><p>In <em>CmakeLists.txt</em></p></li>
</ol>
<p>Below <code class="docutils literal notranslate"><span class="pre">find_package(ament_cmake</span> <span class="pre">REQUIRED)</span></code>, add:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">rosidl_default_generators</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>

<span class="nb">rosidl_generate_interfaces</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>

<span class="p">)</span>

<span class="nb">ament_export_dependencies</span><span class="p">(</span><span class="s">rosidl_default_runtime</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The key point here is to make sure the ROS2 system recognizes your custom interfaces. This is achieved by updating the following section:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">rosidl_generate_interfaces</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>

<span class="p">)</span>
</pre></div>
</div>
<p>We will cover this in more detail when the time comes.</p>
</div>
</div></blockquote>
<ol class="arabic" start="6">
<li><p>Create a custom message</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Create a message file indside the <em>msg</em> directory</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ros2_basics_ws/src/ros2_basics_interfaces/msg
touch<span class="w"> </span>CMiEquipmentStatus.msg
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Pay close attention to naming conventions when creating custom interfaces. Names should start with an uppercase letter, and each new word should also begin with an uppercase letter. Do <strong>NOT</strong> use <code class="docutils literal notranslate"><span class="pre">-</span></code> or <code class="docutils literal notranslate"><span class="pre">_</span></code> in the name. Avoid including “Msg” or “Message” in the name, simply use the <em>.msg</em> extension at the end. The same convention applies to services, but with the <em>.srv</em> extension.</p>
</div>
<ol class="loweralpha simple" start="2">
<li><p>Message definition</p></li>
</ol>
<p>Define the fields in your message to match the needs of your application. In this example, we will gather status information from a piece of equipment in the clean room at the CMi. In the file <em>CMiEquipmentStatus.msg</em>, add the following fields:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>string<span class="w"> </span>equipment_id
string<span class="w"> </span>equipment_name
string<span class="w"> </span>status
float32<span class="w"> </span>temperature
float32<span class="w"> </span>humidity
bool<span class="w"> </span>is_operational
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can find a list of the predefined data types available in ROS2 in the <a class="reference external" href="https://docs.ros.org/en/humble/Concepts/Basic/About-Interfaces.html" rel="noopener noreferrer" target="_blank">official documentation</a>.</p>
</div>
<ol class="loweralpha simple" start="3">
<li><p>Update <em>CMakeLists.txt</em></p></li>
</ol>
<p>As mentionned earlier, we need to include the message file in <em>CMakeLists.txt</em> in order to tell the ROS2 system that it exists. As a comparison, it is similar as adding an entrypoint for a new executable. Here is the update:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rosidl_generate_interfaces<span class="o">(</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span>
<span class="w">    </span><span class="s2">&quot;msg/CMiEquipmentStatus.msg&quot;</span>
<span class="o">)</span>
</pre></div>
</div>
<ol class="loweralpha simple" start="4">
<li><p>Build the package</p></li>
</ol>
<p>Now that we have two packages, you can use the following command in order to build just the desired one:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>colcon<span class="w"> </span>build<span class="w"> </span>--packages-select<span class="w"> </span>ros2_basics_interfaces
</pre></div>
</div>
<ol class="loweralpha simple" start="5">
<li><p>Verify it was properly installed</p></li>
</ol>
<p>Once the build is complete, source the <em>install/setup.bash</em> file and verify that the newly created custom message is available and has the correct structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>install/setup.bash
ros2<span class="w"> </span>interface<span class="w"> </span>show<span class="w"> </span>ros2_basics_interfaces/msg/CMiEquipmentStatus
</pre></div>
</div>
<p>You have successfully created your own message definition, and it can now be used just like any standard ROS2 message in your programs. Do not forget to include the package and message type at the beginning of your files.</p>
</div></blockquote>
</li>
<li><p>Create a custom service</p></li>
</ol>
<p>To create a custom service definition, follow a procedure similar to creating a custom message. You will need to add a <em>.srv</em> file to the <em>srv/</em> folder and respect the request/response structure specific to services, which is as follows:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Define the <strong>request message</strong></p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">---</span></code> to indicate the separation between the request and response messages</p></li>
<li><p>Define the <strong>response message</strong></p></li>
</ol>
</div></blockquote>
<p>Here is an example of what a file named <em>StudentGrades.srv</em> might look like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>string<span class="w"> </span>student_name
uint8<span class="o">[]</span><span class="w"> </span>student_grades
---
bool<span class="w"> </span>success
</pre></div>
</div>
<p>In this example, the service checks whether a student has passed his exams based on his grades. The request includes the student’s name and grades, while the response indicates whether or not the student has passed.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Unlike entrypoints in <em>setup.py</em>, you must <strong>NOT</strong> separate the declarations of your interfaces with <code class="docutils literal notranslate"><span class="pre">,</span></code>. This is the correct way to do it:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">rosidl_generate_interfaces</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
<span class="w">    </span><span class="s2">&quot;msg/CMiEquipmentStatus.msg&quot;</span>
<span class="w">    </span><span class="s2">&quot;srv/StudentGrades.srv&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While developing your own custom interfaces can be useful, keep in mind that there are many common interfaces already available in ROS2 that can meet the needs of your project. You can learn more about these interfaces <a class="reference external" href="https://github.com/ros2/common_interfaces" rel="noopener noreferrer" target="_blank">here</a>.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="prep_work_1.html" class="btn btn-neutral float-left" title="Preparatory Work 1" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="prep_work_2.html" class="btn btn-neutral float-right" title="Preparatory Work 2" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Luca Sidoti Pinto.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>