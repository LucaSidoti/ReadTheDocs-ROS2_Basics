

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Preparatory Work 3 &mdash; ROS2 Basics  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=7ab3649f" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="_static/code-tabs.css?v=1bc26e2f" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=51e3bf41" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="_static/togglebutton.js?v=4a39c7ea"></script>
      <script src="_static/code-tabs.js?v=c983d12e"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="_static/custom.js?v=44801762"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Session 3" href="session_3.html" />
    <link rel="prev" title="Session 2" href="session_2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            ROS2 Basics
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="prep_work_1.html">Preparatory Work 1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#why-ros2">Why ROS2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#selecting-a-ros2-distribution">Selecting a ROS2 Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#why-docker">Why Docker?</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#installing-docker-desktop">Installing Docker Desktop</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#exploring-tools">Exploring Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#learning-basic-linux-commands">Learning Basic Linux Commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="session_1.html">Session 1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#ros2-installation">ROS2 Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#ros2-project-build">ROS2 Project Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#first-node">First Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#communication-overview">Communication Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#topics-overview">Topics Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#exercise-1">Exercise 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#parameters-overview-optional">Parameters Overview - Optional</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#services-overview">Services Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#custom-interfaces">Custom Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prep_work_2.html">Preparatory Work 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prep_work_2.html#thymio-example">Thymio Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_2.html#exercise-2">Exercise 2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="session_2.html">Session 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#urdf-tutorial-example">URDF Tutorial Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#launch-files-overview">Launch Files Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#urdf-overview">URDF Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#minimal-urdf-visual">Minimal URDF - Visual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#first-link">First Link</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#first-joint">First Joint</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#thymio-step-1">Thymio - Step 1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#improved-urdf-xacro">Improved URDF - Xacro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#thymio-step-2">Thymio - Step 2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#gazebo-overview">Gazebo Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#complete-urdf-collision-inertial">Complete URDF - Collision &amp; Inertial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#collision-tags">Collision Tags</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#inertial-tags">Inertial Tags</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#thymio-step-3">Thymio - Step 3</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#spawn-robot-in-gazebo">Spawn Robot in Gazebo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#thymio-step-4">Thymio - Step 4</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#gazebo-plugins">Gazebo Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#thymio-step-5">Thymio - Step 5</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#thymio-step-6">Thymio - Step 6</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#gazebo-worlds-optional">Gazebo Worlds - Optional</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Preparatory Work 3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#turtlesim-overview">Turtlesim Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercise-3">Exercise 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulation-underlays-optional">Simulation Underlays - Optional</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="session_3.html">Session 3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="session_3.html#thymio-mini-project-overview">Thymio Mini-Project Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_3.html#thymio-mini-project">Thymio Mini-Project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#reference-resources">Reference Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-1">Step 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-2">Step 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-3">Step 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-4">Step 4</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-5">Step 5</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-6">Step 6</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#step-7-bonus">Step 7 - Bonus</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_3.html#extra-optional">Extra - Optional</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ROS2 Basics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Preparatory Work 3</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/prep_work_3.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="preparatory-work-3">
<h1>Preparatory Work 3<a class="headerlink" href="#preparatory-work-3" title="Link to this heading"></a></h1>
<p>Your ROS2 journey is almost complete, but before we dive into the final session, it is important to solidify your understanding of key concepts. In the final session, you will be working on a mini-project that will require you to apply your knowledge of <strong>topics</strong> and <strong>services</strong>. To ensure you are fully prepared, we have designed a challenge that will help you review these concepts using one of the most iconic ROS2 packages: <strong>turtlesim</strong>.</p>
<p>This challenge will serve as a foundation for the skills you will need in the mini-project, allowing you to approach the final task with confidence.</p>
<p>Additionally, as mentioned in Session 2, we have included a section to analyze the launch files used in the previous session. While this analysis is not mandatory, it offers valuable insights into how a URDF is handled in ROS2, the role of TFs in tracking robot motion, and the underlying mechanisms that bring robot simulations to life. Feel free to explore this section if you wish to enhance your background knowledge.</p>
<section id="turtlesim-overview">
<h2>Turtlesim Overview<a class="headerlink" href="#turtlesim-overview" title="Link to this heading"></a></h2>
<p>The <em>turtlesim</em> package is a well-known tool for beginners in ROS2, often used to introduce core concepts. It simulates a simple turtle in a 2D space, which you can control using various ROS2 tools.</p>
<p>Now it is time for you to try this turtle simulation:</p>
<ol class="arabic simple">
<li><p>Open a terminal and launch the <em>turtlesim</em> node with the following command:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>turtlesim<span class="w"> </span>turtlesim_node
</pre></div>
</div>
<p>A window with a turtle in the center should appear.</p>
<ol class="arabic simple" start="2">
<li><p>In a second terminal, start the <em>teleop_turtle</em> node to control the turtle:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>turtlesim<span class="w"> </span>turtle_teleop_key
</pre></div>
</div>
<p>This allows you to control the turtle using your keyboard’s arrow keys: <code class="docutils literal notranslate"><span class="pre">◄</span></code>, <code class="docutils literal notranslate"><span class="pre">▲</span></code>, <code class="docutils literal notranslate"><span class="pre">▼</span></code>, <code class="docutils literal notranslate"><span class="pre">►</span></code>. Try moving the turtle around the screen.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the turtle does not move, ensure that the terminal running the <em>teleop_turtle</em> node is active. Click inside the terminal and try again.</p>
</div>
<ol class="arabic simple" start="3">
<li><p>Explore topics and services</p></li>
</ol>
<p>Now that you have turtlesim running, let’s explore some of the topics and services it offers.</p>
<p>First, list the available topics:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">topic</span> <span class="nb">list</span>
</pre></div>
</div>
<p>This will display the topics that can be used to interact with the turtle. Two of them will be particularly useful for you.</p>
<p>Next, list the available services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">service</span> <span class="nb">list</span>
</pre></div>
</div>
<p>The <em>turtlesim</em> package provides several services. You will use one of these to modify the turtle’s behavior.</p>
</section>
<section id="exercise-3">
<h2>Exercise 3<a class="headerlink" href="#exercise-3" title="Link to this heading"></a></h2>
<p>Now that you are familiar with <em>turtlesim</em>, let’s dive into the challenge!</p>
<h3 style="font-size: 1.25em; font-weight: bold; margin: 1em 0;">Turtlesim Challenge</h3><p>Run the turtlesim node and create an additional node to control the turtle’s movement. The turtle should move in a circular path starting from the center of the <em>TurtleSim</em> window, gradually expanding its path toward the boundaries. Ensure that the turtle stops moving near the window boundaries. Additionally, as the turtle moves, change the pen color dynamically when it enters a different quadrant of the <em>TurtleSim</em> window.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="_images/turtlesim_challenge.png"><img alt="_images/turtlesim_challenge.png" src="_images/turtlesim_challenge.png" style="width: 50%;" />
</a>
<figcaption>
<p><span class="caption-text">Turtlesim challenge - Final result</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition-steps admonition">
<p class="admonition-title">Steps</p>
<ol class="arabic simple">
<li><p><strong>Determine the window boundaries</strong></p></li>
</ol>
<p>Identify <span class="math notranslate nohighlight">\([x_{\text{min}}, x_{\text{max}}]\)</span> and <span class="math notranslate nohighlight">\([y_{\text{min}}, y_{\text{max}}]\)</span></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Use the <em>teleop_turtle</em> node to explore the window</p>
</div>
<ol class="arabic simple" start="2">
<li><p><strong>Move the turtle</strong></p></li>
</ol>
<p>Send velocity commands at a defined frequency to make the turtle move away from the center</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Use the following command-lines to find the information you need:</p>
<ul class="simple">
<li><p>List all topics + message type: <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">topic</span> <span class="pre">list</span> <span class="pre">-t</span></code></p></li>
<li><p>Get details on a message type: <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">interface</span> <span class="pre">show</span> <span class="pre">&lt;msg_type&gt;</span></code></p></li>
</ul>
</div>
<ol class="arabic simple" start="3">
<li><p><strong>Boundary detection</strong></p></li>
</ol>
<p>Stop the turtle when it reaches the boundary limits</p>
<ol class="arabic simple" start="4">
<li><p><strong>Pen color change</strong></p></li>
</ol>
<p>Use a <em>turtlesim</em> service to change the pen color as the turtle enters each new quadrant</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Use the following command-lines to find the information you need:</p>
<ul class="simple">
<li><p>List all services + service type: <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">service</span> <span class="pre">list</span> <span class="pre">-t</span></code></p></li>
<li><p>Get details on a service type: <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">interface</span> <span class="pre">show</span> <span class="pre">&lt;srv_type&gt;</span></code></p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Only call the service when the turtle transitions between quadrants, not continuously.</p>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To review the concepts from a different perspective, consider checking out this tutorial featuring the <em>turtlesim</em> package: <a class="reference external" href="https://www.youtube.com/watch?v=Gg25GfA456o" rel="noopener noreferrer" target="_blank">ROS2 Tutorial</a></p>
</div>
</section>
<section id="simulation-underlays-optional">
<h2>Simulation Underlays - Optional<a class="headerlink" href="#simulation-underlays-optional" title="Link to this heading"></a></h2>
<p>This section is optional and is here to satisfy your curiosity if you wish to explore further. It dives into how simulation is achieved in ROS2, offering a detailed analysis of the underlying processes. In the previous session, we focused on creating a URDF file, or multiple Xacro files, that define the structure and properties of the Thymio robot. We then provided you with launch commands to visualize the robot in Rviz and Gazebo. However, behind the scenes, several essential ROS2 nodes are responsible for making this possible. In this section, we will break down these components and analyze how they work together, giving you a deeper understanding of the integration process.</p>
<p>Let’s run <em>thymio_display_xacro.launch.xml</em>, which enables us to visualize the Thymio model in Rviz and interact with a GUI to adjust joint positions, focusing on the robot’s structure without Gazebo.</p>
<ol class="arabic simple">
<li><p>Launch <em>thymio_display_xacro.launch.xml</em></p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ros2_basics_ws
<span class="nb">source</span><span class="w"> </span>install/setup.bash
ros2<span class="w"> </span>launch<span class="w"> </span>thymio_description<span class="w"> </span>thymio_display_xacro.launch.xml
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Visualize the graph</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rqt_graph
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Configure the <em>Node Graph</em></p></li>
</ol>
<a class="reference internal image-reference" href="_images/rqt_config.png"><img alt="_images/rqt_config.png" class="align-center" src="_images/rqt_config.png" style="width: 70%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<p>Looking at the <em>rqt_graph</em>, we see two main nodes interacting: <code class="docutils literal notranslate"><span class="pre">joint_state_publisher</span></code> and <code class="docutils literal notranslate"><span class="pre">robot_state_publisher</span></code>. The <code class="docutils literal notranslate"><span class="pre">robot_state_publisher</span></code> handles TFs in ROS2 by relying on joint information published by the <code class="docutils literal notranslate"><span class="pre">joint_state_publisher</span></code>. In this case, the <code class="docutils literal notranslate"><span class="pre">joint_state_publisher</span></code> is a GUI tool that lets us adjust joint positions virtually. In a real-world scenario, joint positions would be published by hardware sensors, such as encoders.</p>
<a class="reference internal image-reference" href="_images/rqt_graph.png"><img alt="_images/rqt_graph.png" class="align-center" src="_images/rqt_graph.png" style="width: 100%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<p>For the <code class="docutils literal notranslate"><span class="pre">robot_state_publisher</span></code> to work, it needs the URDF, which defines the robot’s structure and joint placements. This URDF file is passed as a parameter during the launch process. But where exactly can we find it? Let’s explore this:</p>
<ol class="arabic simple">
<li><p>List the different nodes</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>node<span class="w"> </span>list
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>List the parameter of the <code class="docutils literal notranslate"><span class="pre">robot_state_publisher</span></code> node</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>param<span class="w"> </span>list<span class="w"> </span>/robot_state_publisher
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Check the content of the <em>robot_description</em> parameter</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>param<span class="w"> </span>get<span class="w"> </span>/robot_state_publisher<span class="w"> </span>robot_description
</pre></div>
</div>
<p>Now that we have located the parameter containing the Thymio robot’s URDF, let’s take a closer look. This parameter holds the complete description of the robot, which was originally split across multiple files. Using the <em>xacro</em> tool, these files were combined into a single, unified URDF. You can confirm this in the terminal, where the file header states: <em>This document was autogenerated by xacro</em>.</p>
<p>To summarize, let’s refer to the following image for a visual representation:</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="_images/robot_description.png"><img alt="_images/robot_description.png" src="_images/robot_description.png" style="width: 80%;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://articulatedrobotics.xyz/tutorials/ready-for-ros/urdf" rel="noopener noreferrer" target="_blank">Describing robots with URDF (Articulated Robotics)</a></span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Here’s a quick recap of the roles of the two nodes:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">robot_state_publisher</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Updates the robot model and TFs in real-time</p></li>
<li><p>Requires the URDF file as a parameter to define the robot’s structure</p></li>
<li><p>Relies on joint position data to reflect changes in the robot’s state</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">joint_state_publisher</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Provides virtual joint positions in simulation</p></li>
<li><p>Replaced by hardware sensors, such as encoders, in real-world applications</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Having explored the key components of the launch process, let’s now run each node individually in separate terminals to verify if they produce the same outcome.</p>
<ol class="arabic simple">
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">robot_state_publisher</span></code> node</p></li>
</ol>
<p>From the previous explanation, we need to launch the <code class="docutils literal notranslate"><span class="pre">robot_state_publisher</span></code> node and provide the URDF file as a parameter. Additionally, we must use the <em>xacro</em> tool to combine the Xacro files into a single URDF file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>robot_state_publisher<span class="w"> </span>robot_state_publisher<span class="w"> </span>--ros-args<span class="w"> </span>-p<span class="w"> </span>robot_description:<span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>xacro<span class="w"> </span>/home/ubuntu/ros2_basics_ws/install/thymio_description/share/thymio_description/urdf/thymio/thymio.urdf.xacro<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">joint_state_publisher</span></code> node</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>joint_state_publisher_gui<span class="w"> </span>joint_state_publisher_gui
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Run <em>Rviz</em></p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>rviz2<span class="w"> </span>rviz2
</pre></div>
</div>
<p>At this stage, nothing is visible in Rviz. To proceed, you need to configure the interface with the required display settings. Start by adding the <code class="docutils literal notranslate"><span class="pre">RobotModel</span></code> and <code class="docutils literal notranslate"><span class="pre">TF</span></code> plugins, and then adjust their options as follows:</p>
<a class="reference internal image-reference" href="_images/Rviz_config.png"><img alt="_images/Rviz_config.png" class="align-center" src="_images/Rviz_config.png" style="width: 40%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If desired, you can save your current Rviz configuration to avoid reconfiguring everything each time. Save the configuration in the <em>rviz</em> directory of the <em>thymio_description</em> package by navigating to <em>File &gt; Save Config As</em> in RViz and selecting the appropriate location. To try it out, adjust <code class="docutils literal notranslate"><span class="pre">&lt;config_name&gt;.rviz</span></code> in the following command with the name of your saved configuration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>rviz2<span class="w"> </span>rviz2<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;/home/ubuntu/ros2_basics_ws/install/thymio_description/share/thymio_description/rviz/&lt;config_name&gt;.rviz&quot;</span>
</pre></div>
</div>
</div>
<ol class="arabic simple" start="4">
<li><p>Run <em>rqt_graph</em></p></li>
</ol>
<p>Finally, as expected, observe that the result matches exactly what was achieved using the <em>thymio_display_xacro.launch.xml</em> file, where the three executables are launched with identical arguments. The content of the launch file is provided below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>
<span class="w">    </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;urdf_path&quot;</span>
<span class="w">        </span><span class="na">default=</span><span class="s">&quot;$(find-pkg-share thymio_description)/urdf/thymio/thymio.urdf.xacro&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;rviz_config_path&quot;</span>
<span class="w">        </span><span class="na">default=</span><span class="s">&quot;$(find-pkg-share thymio_description)/rviz/rviz_config.rviz&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;robot_state_publisher&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;robot_state_publisher&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;robot_description&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(command &#39;xacro $(var urdf_path)&#39;)&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/node&gt;</span>

<span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;joint_state_publisher_gui&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;joint_state_publisher_gui&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;rviz2&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;rviz2&quot;</span><span class="w"> </span><span class="na">args=</span><span class="s">&quot;-d $(var rviz_config_path)&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For comparison, below is the Python equivalent of the same launch file. While Python launch files can be slightly more complex to write, they offer greater flexibility.</p>
<div class="toggle docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch.substitutions</span> <span class="kn">import</span> <span class="n">Command</span>
<span class="kn">from</span> <span class="nn">launch_ros.parameter_descriptions</span> <span class="kn">import</span> <span class="n">ParameterValue</span>
<span class="kn">from</span> <span class="nn">ament_index_python.packages</span> <span class="kn">import</span> <span class="n">get_package_share_path</span>

<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>

    <span class="n">urdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_package_share_path</span><span class="p">(</span><span class="s1">&#39;thymio_description&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;urdf&#39;</span><span class="p">,</span> <span class="s1">&#39;thymio.urdf.xacro&#39;</span><span class="p">)</span>

    <span class="n">rviz_config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_package_share_path</span><span class="p">(</span><span class="s1">&#39;thymio_description&#39;</span><span class="p">),</span>
                                    <span class="s1">&#39;rviz&#39;</span><span class="p">,</span> <span class="s1">&#39;rviz_config.rviz&#39;</span><span class="p">)</span>

    <span class="n">robot_description</span> <span class="o">=</span> <span class="n">ParameterValue</span><span class="p">(</span><span class="n">Command</span><span class="p">([</span><span class="s1">&#39;xacro &#39;</span><span class="p">,</span> <span class="n">urdf_path</span><span class="p">]),</span> <span class="n">value_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="n">robot_state_publisher_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
        <span class="n">package</span><span class="o">=</span><span class="s2">&quot;robot_state_publisher&quot;</span><span class="p">,</span>
        <span class="n">executable</span><span class="o">=</span><span class="s2">&quot;robot_state_publisher&quot;</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;robot_description&#39;</span><span class="p">:</span> <span class="n">robot_description</span><span class="p">}]</span>
    <span class="p">)</span>

    <span class="n">joint_state_publisher_gui_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
        <span class="n">package</span><span class="o">=</span><span class="s2">&quot;joint_state_publisher_gui&quot;</span><span class="p">,</span>
        <span class="n">executable</span><span class="o">=</span><span class="s2">&quot;joint_state_publisher_gui&quot;</span>
    <span class="p">)</span>

    <span class="n">rviz2_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
        <span class="n">package</span><span class="o">=</span><span class="s2">&quot;rviz2&quot;</span><span class="p">,</span>
        <span class="n">executable</span><span class="o">=</span><span class="s2">&quot;rviz2&quot;</span><span class="p">,</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="n">rviz_config_path</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
        <span class="n">robot_state_publisher_node</span><span class="p">,</span>
        <span class="n">joint_state_publisher_gui_node</span><span class="p">,</span>
        <span class="n">rviz2_node</span>
    <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s add the components needed to use the Thymio robot in Gazebo:</p>
<ol class="arabic simple">
<li><p>Launch <em>thymio_display_xacro.launch.xml</em></p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>thymio_description<span class="w"> </span>thymio_display_xacro.launch.xml
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Launch <em>Gazebo</em></p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>gazebo_ros<span class="w"> </span>gazebo.launch.py
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Spawn the Thymio in Gazebo</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>gazebo_ros<span class="w"> </span>spawn_entity.py<span class="w"> </span>-topic<span class="w"> </span>robot_description<span class="w"> </span>-entity<span class="w"> </span>thymio
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These commands are provided by the <em>gazebo_ros</em> package, which serves as the interface connecting ROS2 and Gazebo.</p>
</div>
<p>At this stage, the Thymio robot should successfully spawn in Gazebo. However, you may notice warning messages in the terminal where <em>thymio_display_xacro.launch.xml</em> was started. These warnings occur due to a conflict between the <code class="docutils literal notranslate"><span class="pre">joint_state_publisher_gui</span></code> node and the <code class="docutils literal notranslate"><span class="pre">gazebo_ros_diff_drive</span></code> plugin, as both attempt to provide information about the wheel positions. To resolve this conflict, the <code class="docutils literal notranslate"><span class="pre">joint_state_publisher_gui</span></code> node must not be executed.</p>
<p>This adjustment was already implemented in the final launch file used at the end of the previous session. Below is the content of the final launch file, <em>thymio.launch.xml</em>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>

<span class="w">    </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;urdf_path&quot;</span>
<span class="w">        </span><span class="na">default=</span><span class="s">&quot;$(find-pkg-share thymio_description)/urdf/thymio/thymio.urdf.xacro&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;rviz_config_path&quot;</span>
<span class="w">        </span><span class="na">default=</span><span class="s">&quot;$(find-pkg-share thymio_description)/rviz/rviz_config.rviz&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;robot_state_publisher&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;robot_state_publisher&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;robot_description&quot;</span>
<span class="w">            </span><span class="na">value=</span><span class="s">&quot;$(command &#39;xacro $(var urdf_path)&#39;)&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/node&gt;</span>

<span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;rviz2&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;rviz2&quot;</span><span class="w"> </span><span class="na">output=</span><span class="s">&quot;screen&quot;</span>
<span class="w">        </span><span class="na">args=</span><span class="s">&quot;-d $(var rviz_config_path)&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;$(find-pkg-share gazebo_ros)/launch/gazebo.launch.py&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;world&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(find-pkg-share thymio_description)/worlds/empty.world&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/include&gt;</span>

<span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;gazebo_ros&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;spawn_entity.py&quot;</span>
<span class="w">        </span><span class="na">args=</span><span class="s">&quot;-topic robot_description -entity thymio</span>
<span class="s">                -x 0.0 -y 0.0 -z 0.0</span>
<span class="s">                -R 0.0 -P 0.0 -Y 0.0&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this launch file, you can modify the spawn position and orientation of the Thymio in Gazebo. Additionally, you can specify a custom world for the robot to spawn in.</p>
</div>
<p>The diagram below provides a comprehensive summary of all the material covered, linking the key concepts and processes discussed throughout this chapter.</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="_images/gazebo.png"><img alt="_images/gazebo.png" src="_images/gazebo.png" style="width: 95%;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://articulatedrobotics.xyz/tutorials/mobile-robot/concept-design/concept-gazebo" rel="noopener noreferrer" target="_blank">Understanding control in Gazebo (Articulated Robotics)</a></span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="session_2.html" class="btn btn-neutral float-left" title="Session 2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="session_3.html" class="btn btn-neutral float-right" title="Session 3" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Luca Sidoti Pinto.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>