

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Session 3 &mdash; ROS2 Basics  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=7ab3649f" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="_static/code-tabs.css?v=1bc26e2f" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=51e3bf41" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="_static/togglebutton.js?v=4a39c7ea"></script>
      <script src="_static/code-tabs.js?v=c983d12e"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="_static/custom.js?v=8a06149f"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Preparatory Work 3" href="prep_work_3.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            ROS2 Basics
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="prep_work_1.html">Preparatory Work 1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#why-ros2">Why ROS2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#selecting-a-ros2-distribution">Selecting a ROS2 Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#why-docker">Why Docker?</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#installing-docker-desktop">Installing Docker Desktop</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#exploring-tools">Exploring Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_1.html#learning-basic-linux-commands">Learning Basic Linux Commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="session_1.html">Session 1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#ros2-installation">ROS2 Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#ros2-project-build">ROS2 Project Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#first-node">First Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#communication-overview">Communication Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#topics-overview">Topics Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#exercise-1">Exercise 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#parameters-overview-optional">Parameters Overview - Optional</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#services-overview">Services Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_1.html#custom-interfaces">Custom Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prep_work_2.html">Preparatory Work 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prep_work_2.html#thymio-example">Thymio Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_2.html#exercise-2">Exercise 2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="session_2.html">Session 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#urdf-tutorial-example">URDF Tutorial Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#launch-files-overview">Launch Files Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#urdf-overview">URDF Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#minimal-urdf-visual">Minimal URDF - Visual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#first-link">First Link</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#first-joint">First Joint</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#thymio-step-1">Thymio - Step 1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#improved-urdf-xacro">Improved URDF - Xacro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#thymio-step-2">Thymio - Step 2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#gazebo-overview">Gazebo Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#complete-urdf-collision-inertial">Complete URDF - Collision &amp; Inertial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#collision-tags">Collision Tags</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#inertial-tags">Inertial Tags</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#thymio-step-3">Thymio - Step 3</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#spawn-robot-in-gazebo">Spawn Robot in Gazebo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#thymio-step-4">Thymio - Step 4</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#gazebo-plugins">Gazebo Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#thymio-step-5">Thymio - Step 5</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_2.html#thymio-step-6">Thymio - Step 6</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="session_2.html#gazebo-worlds-optional">Gazebo Worlds - Optional</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prep_work_3.html">Preparatory Work 3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prep_work_3.html#turtlesim-overview">Turtlesim Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_3.html#exercise-3">Exercise 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="prep_work_3.html#simulation-underlays-optional">Simulation Underlays - Optional</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Session 3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#thymio-mini-project-overview">Thymio Mini-Project Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#thymio-mini-project">Thymio Mini-Project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reference-resources">Reference Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-1">Step 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2">Step 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3">Step 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4">Step 4</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5">Step 5</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-6">Step 6</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-7-bonus">Step 7 - Bonus</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extra-optional">Extra - Optional</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ROS2 Basics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Session 3</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/session_3.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="session-3">
<h1>Session 3<a class="headerlink" href="#session-3" title="Link to this heading"></a></h1>
<p>Time flies, and we are already at the final stretch of our ROS2 Basics journey. For this last session, you will bring together everything you have learned about ROS2, focusing primarily on <strong>topics</strong> and <strong>services</strong>. The objective here is not to implement complex control algorithms but rather to gain hands-on experience with ROS2’s core functionalities in the context of a mini-project.</p>
<p>To ensure a smooth experience for everyone, we have provided a ready-to-use package called <code class="docutils literal notranslate"><span class="pre">thymio_mini_project</span></code>. This includes:</p>
<ul>
<li><p>A <strong>Thymio model</strong> with:</p>
<blockquote>
<div><ul class="simple">
<li><p>A <strong>diff_drive_controller</strong> plugin for velocity control.</p></li>
<li><p><strong>Proximity sensors</strong> (front and rear) for obstacle detection.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>A <strong>Gazebo world</strong> with a pre-defined maze to work on.</p></li>
</ul>
<a class="reference internal image-reference" href="_images/thymio_maze.png"><img alt="_images/thymio_maze.png" class="align-center" src="_images/thymio_maze.png" style="width: 90%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<div class="admonition-action-required admonition">
<p class="admonition-title">Action Required</p>
<p>Please <a class="reference download internal" download="" href="_downloads/7791c035eaa914470e818987665d7660/thymio_mini_project.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span></code></a> the <code class="docutils literal notranslate"><span class="pre">thymio_mini_project</span></code> package required for this session and place it in the <code class="docutils literal notranslate"><span class="pre">/src</span></code> directory of your <code class="docutils literal notranslate"><span class="pre">ros2_basics_ws</span></code> workspace.</p>
</div>
<section id="thymio-mini-project-overview">
<h2>Thymio Mini-Project Overview<a class="headerlink" href="#thymio-mini-project-overview" title="Link to this heading"></a></h2>
<p>The task is to guide the Thymio robot through two parts of a maze. The maze is designed to focus on ROS2 rather than navigation algorithms. To make things straightforward:</p>
<ul class="simple">
<li><p>Each turn in the maze is unambiguous, with only one clear direction to follow, marked by a wall directly in front of the robot.</p></li>
<li><p>At dead ends, the robot does not need to turn backward. Instead, it either executes a specific action to proceed further or comes to a definitive stop.</p></li>
<li><p>Your job is to send the appropriate velocity commands via topics and use services to manage the robot’s position when moving between the two maze sections.</p></li>
<li><p>Use the provided diff_drive_controller plugin for velocity control and the proximity sensors to detect walls.</p></li>
</ul>
<a class="reference internal image-reference" href="_images/thymio_mini_project_final.gif"><img alt="_images/thymio_mini_project_final.gif" class="align-center" src="_images/thymio_mini_project_final.gif" style="width: 50%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<p>Here’s a quick overview of the tasks:</p>
<ol class="arabic simple">
<li><p>Guide the Thymio to the end of the first maze section and stop it in front of the wall.</p></li>
<li><p>Use the provided services to transport the robot to the second maze section.</p></li>
<li><p>Continue controlling the Thymio until it reaches the second dead end and stops.</p></li>
</ol>
<p>Let’s dive in and take on the challenge!</p>
</section>
<section id="thymio-mini-project">
<h2>Thymio Mini-Project<a class="headerlink" href="#thymio-mini-project" title="Link to this heading"></a></h2>
<section id="reference-resources">
<h3>Reference Resources<a class="headerlink" href="#reference-resources" title="Link to this heading"></a></h3>
<p>Here, you can find all the necessary resources to help you tackle the mini-project effectively.</p>
<div class="admonition-useful-material admonition">
<p class="admonition-title">Useful Material</p>
<div class="table-centered"><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>CLI</p></th>
<th class="head"><p>Command</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>List all nodes</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">node</span> <span class="pre">list</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Get details on a node</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">node</span> <span class="pre">info</span> <span class="pre">&lt;node_name&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>List all topics + message type</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">topic</span> <span class="pre">list</span> <span class="pre">-t</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Get details on a message type</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">interface</span> <span class="pre">show</span> <span class="pre">&lt;msg_type&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Display messages published to a topic</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">topic</span> <span class="pre">echo</span> <span class="pre">&lt;topic_name&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>List all services + service type</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">service</span> <span class="pre">list</span> <span class="pre">-t</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Get details on a service type</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">interface</span> <span class="pre">show</span> <span class="pre">&lt;srv_type&gt;</span></code></p></td>
</tr>
</tbody>
</table>
<blockquote>
<div></div></div></blockquote>
<div class="admonition-minimal-node admonition">
<p class="admonition-title">Minimal Node</p>
<div class="toggle docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="k">class</span> <span class="nc">MinimalNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;node_name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Minimal Node has been started&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">minimal_node</span> <span class="o">=</span> <span class="n">MinimalNode</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">minimal_node</span><span class="p">)</span>
    <span class="n">minimal_node</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-minimal-publisher admonition">
<p class="admonition-title">Minimal Publisher</p>
<div class="toggle docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>

<span class="k">class</span> <span class="nc">MinimalPublisher</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;minimal_publisher&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s1">&#39;topic&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">timer_period</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span><span class="n">timer_period</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">timer_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;Hello World: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Publishing: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">minimal_publisher</span> <span class="o">=</span> <span class="n">MinimalPublisher</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">minimal_publisher</span><span class="p">)</span>
    <span class="n">minimal_publisher</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-minimal-subscriber admonition">
<p class="admonition-title">Minimal Subscriber</p>
<div class="toggle docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>

<span class="k">class</span> <span class="nc">MinimalSubscriber</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;minimal_subscriber&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">String</span><span class="p">,</span><span class="s1">&#39;topic&#39;</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">listener_callback</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscription</span>  <span class="c1"># prevent unused variable warning</span>

    <span class="k">def</span> <span class="nf">listener_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;I heard: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">minimal_subscriber</span> <span class="o">=</span> <span class="n">MinimalSubscriber</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">minimal_subscriber</span><span class="p">)</span>
    <span class="n">minimal_subscriber</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-minimal-server admonition">
<p class="admonition-title">Minimal Server</p>
<div class="toggle docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="kn">from</span> <span class="nn">example_interfaces.srv</span> <span class="kn">import</span> <span class="n">AddTwoInts</span>

<span class="k">class</span> <span class="nc">MinimalServer</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;minimal_server&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_service</span><span class="p">(</span><span class="n">AddTwoInts</span><span class="p">,</span> <span class="s1">&#39;add_two_ints&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_two_ints_callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_two_ints_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">response</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Incoming request</span><span class="se">\n</span><span class="s1">a: </span><span class="si">%d</span><span class="s1"> b: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">b</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">response</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
    <span class="n">minimal_server</span> <span class="o">=</span> <span class="n">MinimalServer</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">minimal_server</span><span class="p">)</span>
    <span class="n">minimal_server</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-minimal-client admonition">
<p class="admonition-title">Minimal Client</p>
<div class="toggle docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">example_interfaces.srv</span> <span class="kn">import</span> <span class="n">AddTwoInts</span>


<span class="k">class</span> <span class="nc">MinimalClient</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;minimal_client&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_add_two_ints_server</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">call_add_two_ints_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">AddTwoInts</span><span class="p">,</span> <span class="s2">&quot;add_two_ints&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="mf">1.0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Waiting for Server Add Two Ints...&quot;</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="n">AddTwoInts</span><span class="o">.</span><span class="n">Request</span><span class="p">()</span>
        <span class="n">request</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">request</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>

        <span class="n">future</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_call_add_two_ints</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">callback_call_add_two_ints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">future</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; + &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">sum</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Service call failed </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,))</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">minimal_client</span> <span class="o">=</span> <span class="n">MinimalClient</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">minimal_client</span><span class="p">)</span>
    <span class="n">minimal_client</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="step-1">
<h3>Step 1<a class="headerlink" href="#step-1" title="Link to this heading"></a></h3>
<p>Setup a <em>thymio controller</em> node.</p>
<div class="admonition-test admonition">
<p class="admonition-title">Test</p>
<p>Make sure the node is started when you run it.</p>
</div>
</section>
<section id="step-2">
<h3>Step 2<a class="headerlink" href="#step-2" title="Link to this heading"></a></h3>
<p>Update the <em>thymio controller</em> node to send velocity commands at 10 Hz, making the Thymio move forward in the Gazebo world at a speed of 10 cm/s.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Remember, you can use ROS2 command-line tools to access details about the active topics and services. To do so, ensure the Gazebo simulation is running.</p>
</div>
<div class="admonition-test admonition">
<p class="admonition-title">Test</p>
<ol class="arabic simple">
<li><p>Launch the simulation with the following command:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>thymio_mini_project<span class="w"> </span>thymio_display.launch.xml
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Run your controller node.</p></li>
</ol>
<p>Verify that the Thymio moves forward at the specified speed.</p>
</div>
</section>
<section id="step-3">
<h3>Step 3<a class="headerlink" href="#step-3" title="Link to this heading"></a></h3>
<p>Enhance the controller to stop the Thymio 5 cm away from the first wall.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul class="simple">
<li><p>Add a method to adjust velocity commands based on the distance to the wall (e.g. <code class="docutils literal notranslate"><span class="pre">move_until_wall(velocity_command,</span> <span class="pre">distance_to_wall)</span></code>).</p></li>
<li><p>Use the proximity sensor data (defined as a 2D scan) and focus on the front ray.</p></li>
<li><p>If the sensor detects no obstacle, you may receive a string message. Convert it to a float if needed: <code class="docutils literal notranslate"><span class="pre">float('string_msg')</span></code>.</p></li>
<li><p>Slow down the robot as it approaches the wall for precise stopping.</p></li>
<li><p>To log messages in the terminal with a variable displayed to a specific precision, use the following syntax:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The variable value is: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (formatted to 3 decimal places).&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-test admonition">
<p class="admonition-title">Test</p>
<p>Run the simulation and confirm that the Thymio stops reliably 5 cm away from the wall.</p>
</div>
</section>
<section id="step-4">
<h3>Step 4<a class="headerlink" href="#step-4" title="Link to this heading"></a></h3>
<p>Once the Thymio effectively stops in front of the first wall, prepare it to transition to the second portion of the maze. The first task is to remove the existing Thymio entity from the simulation.</p>
<div class="admonition-test admonition">
<p class="admonition-title">Test</p>
<p>Run the simulation and verify that the Thymio is successfully deleted after stopping at the dead end.</p>
</div>
</section>
<section id="step-5">
<h3>Step 5<a class="headerlink" href="#step-5" title="Link to this heading"></a></h3>
<p>Complete the transition by spawning a new Thymio entity in the second part of the maze at the coordinates <code class="docutils literal notranslate"><span class="pre">(x=0.5,</span> <span class="pre">y=0.3,</span> <span class="pre">yaw=pi/2)</span></code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul class="simple">
<li><p>Ensure that the new Thymio entity is spawned only after the first entity has been successfully deleted.</p></li>
<li><p>Use the ROS2 service for spawning by providing the URDF for the Thymio model. The following Python snippet demonstrates how to process the xacro file, generate the URDF, and store it in the <code class="docutils literal notranslate"><span class="pre">self.robot_description_</span></code> attribute.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">xacro</span>
<span class="kn">import</span> <span class="nn">tf_transformations</span>
<span class="kn">from</span> <span class="nn">ament_index_python.packages</span> <span class="kn">import</span> <span class="n">get_package_share_path</span>

<span class="k">class</span> <span class="nc">YourNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;your_node&quot;</span><span class="p">)</span>

        <span class="n">urdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_package_share_path</span><span class="p">(</span><span class="s1">&#39;thymio_mini_project&#39;</span><span class="p">),</span> <span class="s1">&#39;urdf&#39;</span><span class="p">,</span> <span class="s1">&#39;thymio.urdf.xacro&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot_description_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_xacro_file</span><span class="p">(</span><span class="n">urdf_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Your Node has been started!&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_xacro_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xacro_file_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Process the xacro file</span>
            <span class="n">xacro_parsed</span> <span class="o">=</span> <span class="n">xacro</span><span class="o">.</span><span class="n">process_file</span><span class="p">(</span><span class="n">xacro_file_path</span><span class="p">)</span>
            <span class="n">urdf_xml</span> <span class="o">=</span> <span class="n">xacro_parsed</span><span class="o">.</span><span class="n">toxml</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processed xacro file successfully.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">urdf_xml</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process xacro file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
</pre></div>
</div>
</div>
<div class="admonition-test admonition">
<p class="admonition-title">Test</p>
<p>Run the simulation and confirm that:</p>
<ul class="simple">
<li><p>The first Thymio is deleted before the second one is spawned.</p></li>
<li><p>The new Thymio starts in the correct position in the second maze section.</p></li>
</ul>
</div>
</section>
<section id="step-6">
<h3>Step 6<a class="headerlink" href="#step-6" title="Link to this heading"></a></h3>
<p>Once the Thymio successfully spawn in the second portion of the maze, update the controller to continue the algorithm, guiding the Thymio to the next dead end where it stops definitively.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul class="simple">
<li><p>Determine the optimal stopping distance before the turns so the Thymio aligns in the center of the next corridor after turning.</p></li>
</ul>
<a class="reference internal image-reference" href="_images/thymio_maze_turn.png"><img alt="_images/thymio_maze_turn.png" class="align-center" src="_images/thymio_maze_turn.png" style="width: 40%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<ul>
<li><p>Add a method to handle turns (e.g. <code class="docutils literal notranslate"><span class="pre">turn_angle(velocity_command,</span> <span class="pre">angle)</span></code>).</p></li>
<li><p>Choose one of the following approaches to perform the turn:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Odometry</strong>: Use the robot’s simulated pose, which corresponds to its global position. Apply a tolerance to ensure the turn stops accurately at the desired orientation.</p></li>
<li><p><strong>Proximity Sensors</strong>: Rely on the two rear proximity sensors to detect when the turn is complete. Set an appropriate tolerance to achieve precise alignment.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>For the odometry approach, the following Python snippet might be helpful for working with angles:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">tf_transformations</span> <span class="kn">import</span> <span class="n">euler_from_quaternion</span>

<span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">yaw</span> <span class="o">=</span> <span class="n">euler_from_quaternion</span><span class="p">(</span><span class="n">quaternion</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">wrap_angle_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
    <span class="c1"># Normalize angle to the range [-pi, pi]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Implement a control strategy that guides the Thymio to the dead end and brings it to a stop.</p></li>
</ul>
</div>
<div class="admonition-test admonition">
<p class="admonition-title">Test</p>
<p>Run the simulation and verify that the Thymio:</p>
<ul class="simple">
<li><p>Moves forward on clear paths</p></li>
<li><p>Turns left when unable to move forward and the dead end is not reached</p></li>
<li><p>Stops properly at the dead end</p></li>
</ul>
</div>
</section>
<section id="step-7-bonus">
<h3>Step 7 - Bonus<a class="headerlink" href="#step-7-bonus" title="Link to this heading"></a></h3>
<p>As a bonus challenge, you can try to generalize your controller to handle a more complex maze.</p>
<a class="reference internal image-reference" href="_images/thymio_mini_project_bonus.gif"><img alt="_images/thymio_mini_project_bonus.gif" class="align-center" src="_images/thymio_mini_project_bonus.gif" style="width: 90%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<p>Enhance your control strategy to allow the Thymio to navigate autonomously:</p>
<ul class="simple">
<li><p>The Thymio should move forward as long as no obstacles are detected in front.</p></li>
<li><p>When a wall is detected directly ahead, it must decide whether to turn left or right based on the available paths (note that only one direction or none will be possible, never both).</p></li>
<li><p>When the Thymio reaches the dead end, it should stop.</p></li>
</ul>
<p>The new spawn coordinates are <code class="docutils literal notranslate"><span class="pre">(x=1.3,</span> <span class="pre">y=0.1,</span> <span class="pre">yaw=pi)</span></code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul class="simple">
<li><p>Decide the appropriate moment to determine the turn direction. This may require updating one of the previous methods.</p></li>
<li><p>Use the lateral proximity sensors to decide which side to turn, keeping in mind that their angled placement limits their ability to detect walls directly beside the robot.</p></li>
</ul>
<a class="reference internal image-reference" href="_images/thymio_sensors.png"><img alt="_images/thymio_sensors.png" class="align-center" src="_images/thymio_sensors.png" style="width: 40%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
</div>
<div class="admonition-test admonition">
<p class="admonition-title">Test</p>
<p>Run the simulation and verify that the Thymio:</p>
<ul class="simple">
<li><p>Moves forward on clear paths</p></li>
<li><p>Chooses the appropriate turn when facing a wall</p></li>
<li><p>Stops properly at the dead end</p></li>
</ul>
</div>
<p>Congratulations on reaching this point! You have successfully completed the Thymio mini-project. Well done!</p>
</section>
<section id="extra-optional">
<h3>Extra - Optional<a class="headerlink" href="#extra-optional" title="Link to this heading"></a></h3>
<p>What? This was not enough for you? If you are looking to push yourself further, try tackling an even more challenging maze. In this scenario, the goal is to reach the maze’s exit. However, the previous method will not work as it requires turning only when a wall is directly in front. Instead, you will need to detect and take turns where there is no wall ahead, using for instance a <strong>wall-following</strong> approach. You may choose to follow either the left or the right wall.</p>
<a class="reference internal image-reference" href="_images/thymio_maze_6x6.png"><img alt="_images/thymio_maze_6x6.png" class="align-center" src="_images/thymio_maze_6x6.png" style="width: 70%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
<p>The first step is to update the Gazebo world in the launch file. Open <em>thymio_display.launch</em> and apply the following modification:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;$(find-pkg-share gazebo_ros)/launch/gazebo.launch.py&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="cm">&lt;!-- &lt;arg name=&quot;world&quot; value=&quot;$(find-pkg-share thymio_mini_project)/worlds/two_parts_maze.world&quot;/&gt; --&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;world&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(find-pkg-share thymio_mini_project)/worlds/maze_6x6.world&quot;</span><span class="nt">/&gt;</span>
<span class="w"> </span><span class="nt">&lt;/include&gt;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul class="simple">
<li><p>Use the lateral proximity sensors to detect openings on the chosen side (left or right).</p></li>
<li><p>Develop a strategy to turn toward the chosen wall when an opening is detected.</p></li>
<li><p>One possible approach is to adjust forward motion for a specific distance to ensure the robot passes through the middle of the opening. You can implement a method, such as: <code class="docutils literal notranslate"><span class="pre">move_forward(command_velocity,</span> <span class="pre">distance)</span></code>, using odometry to control the motion precisely. The following function can help calculate the Euclidean distance traveled:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_distance_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_position</span><span class="p">,</span> <span class="n">current_position</span><span class="p">):</span>
    <span class="c1"># Calculate Euclidean distance</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">current_position</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">initial_position</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">current_position</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">initial_position</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Adapt your control strategy to implement a general wall-following logic, allowing the Thymio to dynamically adjust its behavior based on wall openings on the chosen side. Ensure the logic also handles dead-end scenarios by making the Thymio turn around and continue wall-following.</p></li>
</ul>
</div>
<div class="admonition-test admonition">
<p class="admonition-title">Test</p>
<p>Verify that your wall-following algorithm performs as expected. Below is an example outcome for the left-wall-following approach:</p>
<a class="reference internal image-reference" href="_images/thymio_mini_project_extra.gif"><img alt="_images/thymio_mini_project_extra.gif" class="align-center" src="_images/thymio_mini_project_extra.gif" style="width: 60%;" />
</a>
<p><div style="margin-top: 5px;"></div></p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="prep_work_3.html" class="btn btn-neutral float-left" title="Preparatory Work 3" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Luca Sidoti Pinto.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>